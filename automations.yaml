- id: '1643640720985'
  alias: Main Door Controller
  description: Control Away Mode, Living and Dining Rooms
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: 0df2cd0b0fa9112188778c56db622911
      helper_last_controller_event: input_text.zz_dining_room_lights_controller_1_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id: input_boolean.away_mode
          state: 'on'
        then:
        - data: {}
          target:
            entity_id: input_boolean.away_mode
          action: input_boolean.turn_off
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.dining_room_lights
            - light.dining_room_pendant_light_entity
            - light.living_room_lights
            - light.living_room_pendant_light_entity
            command: set_recommended_room_scene
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.dining_room_lights
          - light.dining_room_pendant_light_entity
          - light.living_room_lights
          - light.living_room_pendant_light_entity
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.dining_room_lights
          - light.dining_room_pendant_light_entity
          - light.living_room_lights
          - light.living_room_pendant_light_entity
          command: turn_off_room
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.dining_room_lights
          - light.dining_room_pendant_light_entity
          - light.living_room_lights
          - light.living_room_pendant_light_entity
          command: lights_darken
      button_up_long_loop: true
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_down_long_max_loop_repeats: 50
      action_button_down_double:
      - action: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.away_mode
      button_down_double_press: true
      helper_double_press_delay: 500
- id: '1643641631013'
  alias: Playroom Lights Controller
  description: Control the Playroom Lights
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: 867b78e6f7808ffcceb260be52b0c174
      helper_last_controller_event: input_text.zz_playroom_lights_controller_last_event
      action_button_up_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.playroom_lights
          - light.yard_light_entity
          command: lights_on
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.playroom_lights
          - light.yard_light_entity
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.playroom_lights
          - light.yard_light_entity
          command: lights_off
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.playroom_lights
          - light.yard_light_entity
          command: lights_darken
      button_up_long_max_loop_repeats: 50
      button_down_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_up_long_loop: true
      action_button_up_double:
      - if:
        - condition: state
          entity_id:
          - automation.playroom_motion_lights
          - automation.yard_motion_light
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.yard_light_entity
            - light.playroom_lights
            command: lights_manual_control
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.yard_light_entity
            - light.playroom_lights
            command: lights_auto_control
      button_up_double_press: true
- id: '1643644178195'
  alias: Powder Room Lights Controller
  description: Control the Powder Room Lights
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: 8fd4f8715be89cc0f383c887c3fac892
      helper_last_controller_event: input_text.zz_powder_room_lights_controller_last_event
      action_button_up_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.powder_room_pendant_light_entity
          command: lights_on
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.powder_room_pendant_light_entity
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.powder_room_pendant_light_entity
          command: lights_off
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.powder_room_pendant_light_entity
          command: lights_darken
      button_up_long_loop: true
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_down_long_max_loop_repeats: 50
      button_up_double_press: true
      action_button_up_double:
      - if:
        - condition: state
          entity_id: automation.powder_room_motion_pendant_light
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.powder_room_pendant_light_entity
            command: lights_manual_control
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.powder_room_pendant_light_entity
            command: lights_auto_control
- id: '1643646541355'
  alias: Junior Bathroom Lights Controller
  description: Control the Junior Bathroom Lights
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: f084f2e55c0800941585a50dd83e5f47
      helper_last_controller_event: input_text.zz_junior_bathroom_lights_controller_last_event
      action_button_up_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.junior_bathroom_lights
          command: lights_on
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.junior_bathroom_lights
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.junior_bathroom_lights
          command: lights_off
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.junior_bathroom_lights
          command: lights_darken
      button_up_long_loop: true
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_down_long_max_loop_repeats: 50
      action_button_up_double:
      - if:
        - condition: state
          entity_id: automation.junior_bathroom_motion_lights
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.junior_bathroom_lights
            command: lights_manual_control
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.junior_bathroom_lights
            command: lights_auto_control
      button_up_double_press: true
- id: '1643721003621'
  alias: Auto Cooling at Night
  description: Turn on Fan Auto Control at night in bedrooms
  triggers:
  - at: input_datetime.sleep_hours_start
    id: start
    trigger: time
  - at: sensor.parents_room_auto_cooling_at_night_end_time
    id: parents_room
    trigger: time
  - value_template: '{{ now() > [as_datetime(states(''input_datetime.elis_next_alarm'')).astimezone(now().tzinfo)
      - timedelta(minutes = 30), today_at(''10:00'')] | min }}'
    id: elis_room
    trigger: template
  - value_template: '{{ now() > [as_datetime(states(''input_datetime.elenas_next_alarm'')).astimezone(now().tzinfo)
      - timedelta(minutes = 30), today_at(''10:00'')] | min }}'
    id: elenas_room
    trigger: template
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - start
    then:
    - data: {}
      target:
        entity_id:
        - automation.elenas_room_fan_auto_control
        - automation.elis_room_fan_auto_control
        - automation.dining_room_fan_auto_control
        - automation.living_room_fan_auto_control
        - automation.study_room_fan_auto_control
        - automation.parents_room_fan_auto_control
      action: automation.turn_on
    else:
    - condition: template
      value_template: '{{ is_state(''binary_sensor.'' + trigger.id + ''_door'', ''off'')
        }}'
    - target:
        entity_id:
        - automation.{{ trigger.id }}_fan_auto_control
      action: automation.turn_off
      data:
        stop_actions: true
    - target:
        entity_id: climate.{{ trigger.id }}_ac
      action: climate.turn_off
  mode: parallel
  max: 5
- id: '1643979293415'
  alias: Notify When AC On With Doors Open
  description: Send a persistent notification when AC is on with doors open, and clear
    notification when no AC is on with doors open
  trigger:
  - platform: state
    entity_id: binary_sensor.ac_on_with_doors_open
    id: notify
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: binary_sensor.ac_on_with_doors_open
    id: clear
    from: 'on'
    to: 'off'
  condition: []
  action:
  - if:
    - condition: trigger
      id: notify
    then:
    - service: notify.mobile_app_aurora
      data:
        message: AC on with doors and windows open
        title: Please close the doors and windows
        data:
          tag: doors_open
    - service: notify.mobile_app_grace
      data:
        message: AC on with doors and windows open
        title: Please close the doors and windows
        data:
          tag: doors_open
    else:
    - service: notify.mobile_app_aurora
      data:
        message: clear_notification
        data:
          tag: doors_open
    - service: notify.mobile_app_grace
      data:
        message: clear_notification
        data:
          tag: doors_open
  mode: single
- id: '1643979577174'
  alias: Notify When Wash Completed
  description: Send a persistent notification when washer is finished, and clear notification
    when washer is unloaded
  trigger:
  - platform: state
    entity_id:
    - input_boolean.washer_load_clean
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.washer_load_clean
      state: 'on'
    then:
    - service: notify.mobile_app_aurora
      data:
        title: Please unload laundry
        message: Wash completed at {{ (now() | string)[11:16] }}
        data:
          tag: washer_load_clean
          clickAction: /lovelace/washer
    - service: notify.mobile_app_grace
      data:
        title: Please unload laundry
        message: Wash completed at {{ (now() | string)[11:16] }}
        data:
          tag: washer_load_clean
    else:
    - service: notify.mobile_app_aurora
      data:
        message: clear_notification
        data:
          tag: washer_load_clean
    - service: notify.mobile_app_grace
      data:
        message: clear_notification
        data:
          tag: washer_load_clean
  mode: single
- id: '1648784734226'
  alias: Notify When Dishwasher Cooldown Completed
  description: Send a persistent notification when dishwasher load is clean, and clear
    notification when dishwasher is unloaded
  trigger:
  - platform: state
    entity_id:
    - input_boolean.dishwasher_load_clean
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.dishwasher_load_clean
      state: 'on'
    then:
    - service: notify.mobile_app_aurora
      data:
        message: Dishwasher cooled down at {{ (now().time()| string)[:5] }}.
        title: Please open dishwasher
        data:
          tag: dishwasher_load_clean
          clickAction: /lovelace/dishwasher
    - service: notify.mobile_app_grace
      data:
        title: Please open dishwasher
        message: Dishwasher cooled down at {{ (now().time()| string)[:5] }}.
        data:
          tag: dishwasher_load_clean
    else:
    - service: notify.mobile_app_aurora
      data:
        message: clear_notification
        data:
          tag: dishwasher_load_clean
    - service: notify.mobile_app_grace
      data:
        message: clear_notification
        data:
          tag: dishwasher_load_clean
  mode: single
- id: '1648798677481'
  alias: Coming Home
  description: Set light, fan and AC levels in the Dining Room when coming home
  trigger:
  - platform: state
    entity_id: binary_sensor.main_door
    to: 'on'
  condition:
  - condition: state
    state: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    entity_id: input_boolean.away_mode
  action:
  - data: {}
    target:
      entity_id: input_boolean.away_mode
    action: input_boolean.turn_off
  - data:
      room:
      - dining_room
      - living_room
    action: script.set_recommended_scene
  mode: single
- id: '1653105007378'
  alias: Notify When Raining With Windows Open
  description: Send a persistent notification if it is raining heavily with windows
    open, and dismiss it if the windows are closed or it is not raining heavily anymore
  trigger:
  - platform: state
    entity_id: sensor.raining_with_windows_open
    to:
  condition: []
  action:
  - if:
    - condition: state
      entity_id: sensor.raining_with_windows_open
      state: alert
    then:
    - service: notify.mobile_app_aurora
      data:
        title: Please close windows
        message: Windows open in heavy rain
        data:
          tag: windows_open_raining
    - service: notify.mobile_app_grace
      data:
        message: Windows open in heavy rain
        title: Please close windows
        data:
          tag: windows_open_raining
    else:
    - service: notify.mobile_app_aurora
      data:
        message: clear_notification
        data:
          tag: windows_open_raining
    - service: notify.mobile_app_grace
      data:
        message: clear_notification
        data:
          tag: windows_open_raining
  mode: single
  max_exceeded: silent
- id: '1653280933582'
  alias: Dishwasher Set State
  description: Set the state of the dishwasher based on its power consumption
  trigger:
  - platform: numeric_state
    entity_id: sensor.dishwasher_watts
    above: 5
    id: washing
  - platform: numeric_state
    entity_id: sensor.dishwasher_watts
    below: 5
    id: idle
  - platform: state
    entity_id:
    - switch.dishwasher
    to: 'off'
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: washing
      sequence:
      - service: input_select.select_option
        data:
          option: Washing
        target:
          entity_id: input_select.dishwasher_status
    - conditions:
      - condition: trigger
        id: idle
      sequence:
      - if:
        - condition: state
          entity_id: input_select.dishwasher_status
          state: Washing
        then:
        - service: input_select.select_option
          data:
            option: Cooling
          target:
            entity_id: input_select.dishwasher_status
        else:
        - service: input_select.select_option
          data:
            option: Standby
          target:
            entity_id: input_select.dishwasher_status
    default:
    - service: input_select.select_option
      data:
        option: 'Off'
      target:
        entity_id: input_select.dishwasher_status
  mode: queued
- id: '1654959141053'
  alias: Water Heater Motion
  description: Turn on water heater if motion detected in Junior Shower
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.junior_shower_motion
    id: motion
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.junior_shower_motion
    id: no_motion
    to: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  condition: []
  action:
  - if:
    - condition: trigger
      id: motion
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.water_heater
    else:
    - service: switch.turn_off
      data: {}
      target:
        entity_id: switch.water_heater
  mode: single
- id: '1659256178839'
  alias: Master Bathroom Lights Controller
  description: Control the Master Bathroom Lights
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: 75fe391df20feec2911c6bf08707c353
      helper_last_controller_event: input_text.zz_master_bathroom_lights_controller_last_event
      action_button_up_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.master_bathroom_lights
          command: lights_on
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.master_bathroom_lights
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.master_bathroom_lights
          command: lights_off
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.master_bathroom_lights
          command: lights_darken
      button_up_long_loop: true
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_down_long_max_loop_repeats: 50
      button_up_double_press: true
      action_button_up_double:
      - if:
        - condition: state
          entity_id:
          - automation.master_bathroom_blind_auto_control
          - automation.master_bathroom_motion_light
          - automation.master_bathroom_motion_pendant_light
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.master_bathroom_light_entity
            - light.master_bathroom_pendant_light_entity
            command: lights_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.master_bathroom_blind
            command: cover_manual_control
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.master_bathroom_light_entity
            - light.master_bathroom_pendant_light_entity
            command: lights_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.master_bathroom_blind
            command: cover_auto_control
- id: '1659256970314'
  alias: Kitchen Lights Controller
  description: Control the Kitchen Lights
  use_blueprint:
    path: EPMatt/ikea_e1743.yaml
    input:
      integration: ZHA
      controller_device: 13c989b42cc6640ec074b9c74df4101c
      helper_last_controller_event: input_text.zz_kitchen_lights_controller_last_event
      action_button_up_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.kitchen_lights
          command: lights_on
      action_button_up_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.kitchen_lights
          command: lights_brighten
      action_button_down_short:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.kitchen_lights
          command: lights_off
      action_button_down_long:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.kitchen_lights
          command: lights_darken
      button_up_long_max_loop_repeats: 50
      button_down_long_max_loop_repeats: 50
      button_down_long_loop: true
      button_up_long_loop: true
      button_up_double_press: true
      action_button_up_double:
      - if:
        - condition: state
          entity_id:
          - automation.kitchen_blind_auto_control
          - automation.kitchen_motion_lights
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.kitchen_lights
            command: lights_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.kitchen_blind
            command: cover_manual_control
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.kitchen_lights
            command: lights_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.kitchen_blind
            command: cover_auto_control
- id: '1660034693952'
  alias: Master Bathroom Blind Auto Control
  description: Control the Master Bathroom Blind based on whether there is motion
    in the Master Shower and whether doors are open at Parents Room and Master Bathroom
  triggers:
  - entity_id:
    - binary_sensor.master_shower_motion
    to: 'on'
    from: 'off'
    id: motion
    trigger: state
  - entity_id:
    - binary_sensor.master_shower_motion
    - binary_sensor.master_bathroom_motion
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    id: no_motion
    trigger: state
  - at: input_datetime.sleep_hours_start
    id: sleep_hours_start
    trigger: time
  - entity_id:
    - binary_sensor.parents_room_door
    - binary_sensor.master_bathroom_door
    from: 'off'
    to: 'on'
    id: door_open
    trigger: state
  - entity_id:
    - binary_sensor.parents_room_motion
    to: 'on'
    id: parents_room_motion
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.away_mode
    to: 'off'
    from: 'on'
    id: away_mode_off
    for: 2
  conditions:
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: motion
      sequence:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.parents_room_door
          state: 'on'
        - condition: state
          entity_id: binary_sensor.master_bathroom_door
          state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.master_bathroom_blind
          state: closed
      - data: {}
        target:
          entity_id: cover.master_bathroom_blind
        action: cover.close_cover
    - conditions:
      - condition: trigger
        id:
        - no_motion
        - away_mode_off
      sequence:
      - condition: and
        conditions:
        - condition: state
          entity_id: binary_sensor.master_bathroom_motion
          state: 'off'
          for:
            hours: 0
            minutes: 10
            seconds: 0
        - condition: state
          state: 'off'
          entity_id: binary_sensor.master_shower_motion
          for:
            hours: 0
            minutes: 10
            seconds: 0
        - condition: time
          after: input_datetime.sleep_hours_end
          before: input_datetime.sleep_hours_start
          weekday:
          - sun
          - fri
          - sat
          - thu
          - wed
          - tue
          - mon
        - condition: state
          entity_id: binary_sensor.master_bathroom_door
          state: 'on'
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.master_bathroom_blind
          attribute: current_position
          state: '100'
      - data: {}
        target:
          entity_id: cover.master_bathroom_blind
        action: cover.open_cover
    - conditions:
      - condition: trigger
        id: sleep_hours_start
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.master_bathroom_blind
          state: closed
      - data: {}
        target:
          entity_id: cover.master_bathroom_blind
        action: cover.close_cover
    - conditions:
      - condition: trigger
        id: door_open
      sequence:
      - condition: and
        conditions:
        - condition: time
          after: input_datetime.sleep_hours_end
          weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
          - sat
          - sun
          before: input_datetime.sleep_hours_start
        - condition: state
          entity_id: binary_sensor.master_shower_motion
          state: 'off'
          for:
            hours: 0
            minutes: 10
            seconds: 0
        - condition: state
          entity_id: climate.parents_room_ac
          state: 'off'
        - condition: state
          entity_id: fan.parents_room_fan
          state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.master_bathroom_blind
          attribute: current_position
          state: '100'
      - data: {}
        target:
          entity_id: cover.master_bathroom_blind
        action: cover.open_cover
    - conditions:
      - condition: trigger
        id:
        - parents_room_motion
      sequence:
      - condition: time
        after: input_datetime.sleep_hours_start
        before: input_datetime.sleep_hours_end
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.master_bathroom_blind
          state: closed
      - data: {}
        target:
          entity_id: cover.master_bathroom_blind
        action: cover.close_cover
    default: []
  mode: restart
- id: '1660480730988'
  alias: Master Bathroom Blind Controller
  description: Control the Master Bathroom Blind
  use_blueprint:
    path: EPMatt/ikea_e1766.yaml
    input:
      integration: ZHA
      controller_device: 92725db1f0698cbe535382e777d98b52
      helper_last_controller_event: input_text.zz_master_bathroom_blind_controller_last_event
      action_button_up_short:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.master_bathroom_blind
          command: cover_open
      action_button_down_short:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.master_bathroom_blind
          command: cover_close
      action_button_up_double:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.master_bathroom_blind
          command: cover_auto_control
      action_button_down_double:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.master_bathroom_blind
          command: cover_manual_control
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
- id: '1661601576517'
  alias: Washer Load Clean
  description: Indicate when the washer load is clean and needs unloading
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.washer_wash_completed
    to: 'on'
    id: finished
    from: 'off'
  - platform: state
    entity_id:
    - binary_sensor.washer_door
    from: 'off'
    to: 'on'
    id: opened
  condition: []
  action:
  - if:
    - condition: trigger
      id: finished
    then:
    - condition: state
      entity_id: binary_sensor.washer_door
      state: 'off'
    - data: {}
      target:
        entity_id: input_boolean.washer_load_clean
      action: input_boolean.turn_on
    else:
    - data: {}
      target:
        entity_id: input_boolean.washer_load_clean
      action: input_boolean.turn_off
  mode: single
- id: '1661612907662'
  alias: Dishwasher Load Clean
  description: Indicate when the dishwasher load is clean and needs unloading
  trigger:
  - platform: state
    entity_id:
    - input_select.dishwasher_status
    id: finished
    from: Cooling
    to: 'Off'
  - platform: state
    entity_id:
    - binary_sensor.dishwasher_door
    from: 'off'
    to: 'on'
    id: opened
  condition: []
  action:
  - if:
    - condition: trigger
      id: finished
    then:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.dishwasher_load_clean
    else:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.dishwasher_load_clean
  mode: single
- id: '1664539716957'
  alias: Stove Set State
  description: Set the state of the stove according to input_helpers
  trigger:
  - platform: state
    entity_id:
    - select.stove_current_burner_power
    id: select
  - platform: state
    entity_id:
    - input_number.stove_current_burner_power_slider
    id: slider
  - platform: state
    entity_id:
    - input_boolean.stove_select_left_burner
    id: left_burner
  - platform: state
    entity_id:
    - input_boolean.stove_select_right_burner
    id: right_burner
  - platform: state
    entity_id:
    - select.stove_current_burner
    id: burner
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: select
      sequence:
      - service: input_number.set_value
        data:
          value: '{{ states(''select.stove_current_burner_power'') }}'
        target:
          entity_id: input_number.stove_current_burner_power_slider
    - conditions:
      - condition: trigger
        id: slider
      sequence:
      - service: select.select_option
        data:
          option: '{{ states(''input_number.stove_current_burner_power_slider'') |
            int(0) }}'
        target:
          entity_id: select.stove_current_burner_power
    - conditions:
      - condition: trigger
        id: left_burner
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.stove_select_left_burner
          state: 'on'
        then:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.stove_select_right_burner
        - service: select.select_option
          data:
            option: left
          target:
            entity_id: select.stove_current_burner
        else:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.stove_select_right_burner
        - service: select.select_option
          data:
            option: right
          target:
            entity_id: select.stove_current_burner
    - conditions:
      - condition: trigger
        id: right_burner
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.stove_select_right_burner
          state: 'on'
        then:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.stove_select_left_burner
        - service: select.select_option
          data:
            option: right
          target:
            entity_id: select.stove_current_burner
        else:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.stove_select_left_burner
        - service: select.select_option
          data:
            option: left
          target:
            entity_id: select.stove_current_burner
    - conditions:
      - condition: trigger
        id: burner
      sequence:
      - if:
        - condition: state
          entity_id: select.stove_current_burner
          state: left
        then:
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.stove_select_right_burner
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.stove_select_left_burner
        else:
        - service: input_boolean.turn_on
          data: {}
          target:
            entity_id: input_boolean.stove_select_right_burner
        - service: input_boolean.turn_off
          data: {}
          target:
            entity_id: input_boolean.stove_select_left_burner
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 10
  mode: single
  max_exceeded: silent
- id: '1667350498199'
  alias: Away Mode
  description: Set automated controls and devices for away mode
  triggers:
  - entity_id:
    - input_boolean.away_mode
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.away_mode
      state: 'on'
    then:
    - data:
        stop_actions: true
      target:
        entity_id:
        - automation.auto_cooling_at_night
        - automation.elenas_room_fan_auto_control
        - automation.elis_room_fan_auto_control
        - automation.parents_room_fan_auto_control
        - automation.dining_room_fan_auto_control
        - automation.living_room_fan_auto_control
        - automation.study_room_fan_auto_control
        - automation.hallway_motion_lights
        - automation.junior_bathroom_motion_lights
        - automation.kitchen_blind_auto_control
        - automation.master_bathroom_motion_light
        - automation.master_bathroom_motion_pendant_light
        - automation.powder_room_motion_pendant_light
        - automation.water_heater_motion
        - automation.south_facing_blinds_auto_control
        - automation.lights_for_wind_down
        - automation.lights_for_sleep_hours_start
        - automation.daniels_alarm
        - automation.elis_alarm
        - automation.graces_alarm
        - automation.parents_room_motion_ac
        - automation.parents_room_motion_fan
        - automation.parents_room_motion_lights
        - automation.parents_room_motion_bedside_lamp
        - automation.elenas_room_motion_ac
        - automation.elenas_room_motion_fan
        - automation.elenas_room_motion_lights
        - automation.elenas_room_motion_bedside_lamp
        - automation.elis_room_motion_ac
        - automation.elis_room_motion_fan
        - automation.elis_room_motion_lights
        - automation.elis_room_motion_floor_lamp
        - automation.kitchen_motion_lights
        - automation.study_walkway_motion_light
        - automation.playroom_motion_lights
        - automation.yard_motion_light
        - automation.dining_room_motion_ac
        - automation.dining_room_motion_fan
        - automation.dining_room_motion_lights
        - automation.dining_room_motion_pendant_light
        - automation.living_room_motion_ac
        - automation.living_room_motion_fan
        - automation.living_room_motion_lights
        - automation.living_room_motion_pendant_light
        - automation.study_room_motion_ac
        - automation.study_room_motion_fan
        - automation.study_room_motion_lights
        - automation.doorbell
        - automation.study_room_voice_assistant_listening_for_wake_word
        - automation.kitchen_voice_assistant_listening_for_wake_word
        - automation.elenas_room_curtains_auto_control
        - automation.elis_room_curtains_auto_control
        - automation.media_player_occupancy_following
        - automation.yard_motion_automations
        - automation.playroom_motion_automations
        - automation.junior_bathroom_motion_automations
        - automation.powder_room_motion_automations
        - automation.hallway_motion_automations
        - automation.elenas_room_motion_automations
        - automation.elis_room_motion_automations
        - automation.dining_room_motion_automations
        - automation.living_room_motion_automations
        - automation.study_room_motion_automations
        - automation.kitchen_motion_automations
        - automation.master_bathroom_motion_automations
        - automation.parents_room_motion_automations
      enabled: true
      action: automation.turn_off
    - data: {}
      target:
        entity_id: cover.kitchen_blind
      action: cover.close_cover
    - data: {}
      action: script.turn_off_all
    - repeat:
        for_each:
        - cover.elenas_room_curtains
        - cover.elis_room_curtains
        - cover.dining_room_right_blind
        - cover.dining_room_middle_blind
        - cover.dining_room_left_blind
        - cover.living_room_right_blind
        - cover.living_room_middle_blind
        - cover.living_room_left_blind
        - cover.study_room_right_blind
        - cover.study_room_left_blind
        - cover.master_bathroom_blind
        sequence:
        - target:
            entity_id: '{{ repeat.item }}'
          action: cover.close_cover
          continue_on_error: true
        - delay:
            hours: 0
            minutes: 0
            seconds: 2
            milliseconds: 0
    - metadata: {}
      data: {}
      target:
        entity_id:
        - switch.study_room_voice_assistant_use_wake_word
        - switch.kitchen_core_use_wake_word
      action: switch.turn_off
    else:
    - data: {}
      target:
        entity_id:
        - automation.auto_cooling_at_night
        - automation.elenas_room_fan_auto_control
        - automation.elis_room_fan_auto_control
        - automation.parents_room_fan_auto_control
        - automation.dining_room_fan_auto_control
        - automation.living_room_fan_auto_control
        - automation.study_room_fan_auto_control
        - automation.hallway_motion_lights
        - automation.junior_bathroom_motion_lights
        - automation.kitchen_blind_auto_control
        - automation.master_bathroom_motion_light
        - automation.master_bathroom_motion_pendant_light
        - automation.powder_room_motion_pendant_light
        - automation.water_heater_motion
        - automation.south_facing_blinds_auto_control
        - automation.lights_for_wind_down
        - automation.lights_for_sleep_hours_start
        - automation.daniels_alarm
        - automation.elis_alarm
        - automation.graces_alarm
        - automation.parents_room_motion_ac
        - automation.parents_room_motion_fan
        - automation.parents_room_motion_lights
        - automation.parents_room_motion_bedside_lamp
        - automation.elenas_room_motion_ac
        - automation.elenas_room_motion_fan
        - automation.elenas_room_motion_lights
        - automation.elenas_room_motion_bedside_lamp
        - automation.elis_room_motion_ac
        - automation.elis_room_motion_fan
        - automation.elis_room_motion_lights
        - automation.elis_room_motion_floor_lamp
        - automation.kitchen_motion_lights
        - automation.study_walkway_motion_light
        - automation.playroom_motion_lights
        - automation.yard_motion_light
        - automation.dining_room_motion_ac
        - automation.dining_room_motion_fan
        - automation.dining_room_motion_lights
        - automation.dining_room_motion_pendant_light
        - automation.living_room_motion_ac
        - automation.living_room_motion_fan
        - automation.living_room_motion_lights
        - automation.living_room_motion_pendant_light
        - automation.study_room_motion_ac
        - automation.study_room_motion_fan
        - automation.study_room_motion_lights
        - automation.doorbell
        - automation.study_room_voice_assistant_listening_for_wake_word
        - automation.kitchen_voice_assistant_listening_for_wake_word
        - automation.elenas_room_curtains_auto_control
        - automation.elis_room_curtains_auto_control
        - automation.media_player_occupancy_following
        - automation.yard_motion_automations
        - automation.playroom_motion_automations
        - automation.junior_bathroom_motion_automations
        - automation.powder_room_motion_automations
        - automation.hallway_motion_automations
        - automation.elenas_room_motion_automations
        - automation.elis_room_motion_automations
        - automation.dining_room_motion_automations
        - automation.living_room_motion_automations
        - automation.study_room_motion_automations
        - automation.kitchen_motion_automations
        - automation.master_bathroom_motion_automations
        - automation.parents_room_motion_automations
      action: automation.turn_on
      enabled: true
    - repeat:
        sequence:
        - action: automation.trigger
          metadata: {}
          data:
            skip_condition: true
          target:
            entity_id: '{{ repeat.item }}'
        - delay: 5
        for_each:
        - automation.south_facing_blinds_auto_control
        - automation.kitchen_blind_auto_control
        - automation.elis_room_curtains_auto_control
        - automation.elenas_room_curtains_auto_control
    - action: media_player.turn_on
      metadata: {}
      target:
        entity_id:
        - media_player.study_room_speaker
        - media_player.kitchen_speaker
        - media_player.dining_room_speaker
      data: {}
    - action: media_player.volume_set
      metadata: {}
      target:
        entity_id:
        - media_player.study_room_speaker
        - media_player.kitchen_speaker
        - media_player.dining_room_speaker
      data:
        volume_level: 0.5
  mode: single
- id: '1670838907474'
  alias: System Housekeeping
  description: Housekeeping tasks executed on a schedule or to dismiss device discovery
    notifications
  triggers:
  - at: '23:50:00'
    trigger: time
    id: daily
  - trigger: time
    at: 00:50:00
    id: sunday_only_pmbackup_start
  - trigger: time
    at: 01:50:00
    id: sunday_only_pmbackup_end
  - trigger: persistent_notification
    update_type:
    - added
    notification_id: config_entry_discovery
    id: device_discovered
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - daily
      sequence:
      - metadata: {}
        data: {}
        action: shell_command.removeoldmaindoorcamerasnapshots
      - data:
          commit_message: Autocommit on {{ now().day }}/{{ now().month }}/{{ now().year
            }} {{ now().hour }}:{{ now().minute }}
        action: script.git_push
      - condition: state
        entity_id: input_boolean.away_mode
        state: 'off'
      - data: {}
        target:
          entity_id:
          - automation.south_facing_blinds_auto_control
          - automation.kitchen_blind_auto_control
          - automation.dining_room_motion_timeout
          - automation.elenas_room_motion_timeout
          - automation.elis_room_motion_timeout
          - automation.living_room_motion_timeout
          - automation.parents_room_motion_timeout
          - automation.study_walkway_motion_timeout
          - automation.study_room_motion_timeout
          - automation.master_bathroom_blind_auto_control
          - automation.elis_room_curtains_auto_control
          - automation.elenas_room_curtains_auto_control
        action: automation.turn_on
        enabled: true
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.lxc_jupyter
      - delay: 60
      - repeat:
          sequence:
          - action: switch.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: '{{ repeat.item }}'
          - delay: 60
          for_each:
          - switch.docker_container_immich_server
          - switch.docker_container_immich_postgres
          - switch.docker_container_immich_redis
          - switch.docker_container_immich_machine_learning
    - conditions:
      - condition: trigger
        id:
        - sunday_only_pmbackup_start
      sequence:
      - condition: time
        after: 00:49:00
        before: 00:51:00
        weekday:
        - sun
      - repeat:
          sequence:
          - action: switch.turn_off
            metadata: {}
            data: {}
            target:
              entity_id: '{{ repeat.item }}'
          - delay: 60
          for_each:
          - switch.docker_container_immich_server
          - switch.docker_container_immich_postgres
          - switch.docker_container_immich_redis
          - switch.docker_container_immich_machine_learning
    - conditions:
      - condition: trigger
        id:
        - sunday_only_pmbackup_end
      sequence:
      - condition: time
        after: 01:49:00
        before: 01:51:00
        weekday:
        - sun
      - repeat:
          sequence:
          - action: switch.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: '{{ repeat.item }}'
          - delay: 60
          for_each:
          - switch.docker_container_immich_postgres
          - switch.docker_container_immich_redis
          - switch.docker_container_immich_machine_learning
          - switch.docker_container_immich_server
    - conditions:
      - condition: trigger
        id:
        - device_discovered
      sequence:
      - action: persistent_notification.dismiss
        metadata: {}
        data:
          notification_id: config_entry_discovery
  mode: single
- id: '1672302011128'
  alias: South-Facing Blinds Auto Control
  description: Open or close the south-facing blinds based on sun position
  triggers:
  - entity_id:
    - sun.sun
    attribute: rising
    to: false
    trigger: state
  - entity_id: sensor.sun_solar_elevation
    above: 65
    trigger: numeric_state
  - entity_id: sensor.dining_room_lux
    above: input_number.maximum_lux
    trigger: numeric_state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: sun.sun
          attribute: rising
          state: false
        - condition: numeric_state
          entity_id: sensor.sun_solar_elevation
          above: 65
      sequence:
      - repeat:
          for_each:
          - cover.dining_room_right_blind
          - cover.dining_room_middle_blind
          - cover.dining_room_left_blind
          - cover.living_room_right_blind
          - cover.living_room_middle_blind
          - cover.living_room_left_blind
          - cover.study_room_right_blind
          - cover.study_room_left_blind
          sequence:
          - target:
              entity_id: '{{ repeat.item }}'
            continue_on_error: true
            action: cover.open_cover
          - delay: '{{ states(''input_number.blinds_command_deconflict'' ) | int(2)
              }}'
    - conditions:
      - condition: numeric_state
        entity_id: sensor.dining_room_lux
        above: input_number.maximum_lux
      sequence:
      - condition: state
        entity_id: sun.sun
        attribute: rising
        state: true
      - repeat:
          for_each:
          - cover.dining_room_right_blind
          - cover.dining_room_middle_blind
          - cover.dining_room_left_blind
          - cover.living_room_right_blind
          - cover.living_room_middle_blind
          - cover.living_room_left_blind
          - cover.study_room_right_blind
          - cover.study_room_left_blind
          sequence:
          - target:
              entity_id: '{{ repeat.item }}'
            continue_on_error: true
            action: cover.close_cover
          - delay: '{{ states(''input_number.blinds_command_deconflict'' ) | int(2)
              }}'
  mode: single
- id: '1672722028985'
  alias: Rice Cooker Auto Control
  description: Turn on or off the rice cooker based on lid state and idle time
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.rice_cooker_lid
    to: 'off'
    id: lid_closed
  - platform: template
    value_template: '{{ is_state(''switch.rice_cooker'',''on'') and states(''sensor.rice_cooker_watts'')
      | float(0) <= 1 }}'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: idle
  condition: []
  action:
  - if:
    - condition: trigger
      id: lid_closed
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.rice_cooker
    else:
    - service: switch.turn_off
      data: {}
      target:
        entity_id: switch.rice_cooker
  mode: single
- id: '1672734021271'
  alias: Rice Cooker Set State
  description: Set the state of the rice cooker based on power consumption
  trigger:
  - platform: numeric_state
    entity_id: sensor.rice_cooker_watts_recent_max
    above: 200
    id: cooking
  - platform: numeric_state
    entity_id: sensor.rice_cooker_watts_recent_max
    above: 30
    below: 140
    id: warming
  - platform: state
    entity_id:
    - sensor.rice_cooker_watts
    to: '1'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: standby
  - platform: state
    entity_id:
    - switch.rice_cooker
    not_from:
    - unavailable
    - unknown
    not_to:
    - unavailable
    - unknown
    id: power
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: cooking
      sequence:
      - service: input_select.select_option
        data:
          option: Cooking
        target:
          entity_id: input_select.rice_cooker_status
    - conditions:
      - condition: trigger
        id: warming
      sequence:
      - service: input_select.select_option
        data:
          option: Warming
        target:
          entity_id: input_select.rice_cooker_status
    - conditions:
      - condition: trigger
        id: standby
      sequence:
      - service: input_select.select_option
        data:
          option: Standby
        target:
          entity_id: input_select.rice_cooker_status
    - conditions:
      - condition: trigger
        id: power
      sequence:
      - if:
        - condition: state
          entity_id: switch.rice_cooker
          state: 'on'
        then:
        - service: input_select.select_option
          data:
            option: Standby
          target:
            entity_id: input_select.rice_cooker_status
        else:
        - service: input_select.select_option
          data:
            option: 'Off'
          target:
            entity_id: input_select.rice_cooker_status
    default: []
  mode: single
- id: '1672898689403'
  alias: Lights for Wind Down
  description: Set house lights for wind down
  triggers:
  - at: input_datetime.wind_down
    trigger: time
  - entity_id:
    - input_boolean.party_mode
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: template
    value_template: '{{ now() > today_at(states(''input_datetime.wind_down'')) - timedelta(minutes
      = 1) }}'
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  actions:
  - if:
    - condition: state
      entity_id: light.yard_light_entity
      state: 'on'
    then:
    - data:
        transition: 10
        brightness_pct: '{{ states(''input_number.night_light_brightness'') }}'
      target:
        entity_id: light.yard_light_entity
      continue_on_error: true
      action: light.turn_on
    - delay: 2
  - parallel:
    - repeat:
        for_each:
        - light.playroom_bulb_1_entity
        - light.playroom_bulb_2_entity
        - light.playroom_bulb_3_entity
        sequence:
        - if:
          - condition: template
            value_template: '{{ is_state(repeat.item, ''on'') }}'
          then:
          - target:
              entity_id: '{{ repeat.item }}'
            data:
              transition: 10
              brightness_pct: '{{ states(''input_number.night_light_brightness'')
                }}'
            continue_on_error: true
            action: light.turn_on
          - delay: 2
    - repeat:
        for_each:
        - light.kitchen_ceiling_light_entity
        - light.kitchen_bulb_1_entity
        - light.kitchen_bulb_2_entity
        - light.kitchen_bulb_3_entity
        sequence:
        - if:
          - condition: template
            value_template: '{{ is_state(repeat.item, ''on'') }}'
          then:
          - target:
              entity_id: '{{ repeat.item }}'
            data:
              transition: 10
              brightness_pct: '{{ states(''input_number.night_light_brightness'')
                }}'
            continue_on_error: true
            action: light.turn_on
          - delay: 2
    - if:
      - condition: state
        entity_id: binary_sensor.study_room_ethernet_connection
        state: 'off'
      then:
      - repeat:
          for_each:
          - light.study_room_bulb_1_entity
          - light.study_room_bulb_2_entity
          - light.study_room_bulb_3_entity
          - light.study_room_bulb_4_entity
          sequence:
          - if:
            - condition: template
              value_template: '{{ is_state(repeat.item, ''on'') }}'
            then:
            - target:
                entity_id: '{{ repeat.item }}'
              data:
                transition: 10
                brightness_pct: '{{ states(''input_number.night_light_brightness'')
                  }}'
              continue_on_error: true
              action: light.turn_on
            - delay: 2
  - repeat:
      for_each:
      - light.living_room_bulb_1_entity
      - light.living_room_bulb_2_entity
      - light.living_room_bulb_3_entity
      - light.living_room_bulb_4_entity
      - light.living_room_bulb_5_entity
      - light.living_room_bulb_6
      - light.living_room_bulb_7
      sequence:
      - if:
        - condition: template
          value_template: '{{ is_state(repeat.item, ''on'') }}'
        then:
        - target:
            entity_id: '{{ repeat.item }}'
          data:
            transition: 10
          continue_on_error: true
          action: light.turn_off
        - delay: 2
  - if:
    - condition: state
      entity_id: light.living_room_pendant_light_entity
      state: 'on'
    then:
    - data:
        brightness_pct: '{{ states(''input_number.night_light_brightness'') }}'
        transition: 10
      target:
        entity_id: light.living_room_pendant_light_entity
      continue_on_error: true
      action: light.turn_on
  - repeat:
      for_each:
      - light.dining_room_bulb_1_entity
      - light.dining_room_bulb_2_entity
      - light.dining_room_bulb_3_entity
      - light.dining_room_bulb_4_entity
      - light.dining_room_bulb_5
      sequence:
      - if:
        - condition: template
          value_template: '{{ is_state(repeat.item, ''on'') }}'
        then:
        - target:
            entity_id: '{{ repeat.item }}'
          data:
            transition: 10
          continue_on_error: true
          action: light.turn_off
        - delay: 2
  - if:
    - condition: state
      entity_id: light.dining_room_pendant_light_entity
      state: 'on'
    then:
    - data:
        transition: 10
        brightness_pct: '{{ states(''input_number.night_light_brightness'') }}'
      target:
        entity_id: light.dining_room_pendant_light_entity
      continue_on_error: true
      action: light.turn_on
  - repeat:
      for_each:
      - light.hallway_bulb_1_entity
      - light.hallway_bulb_2_entity
      sequence:
      - if:
        - condition: template
          value_template: '{{ is_state(repeat.item, ''on'') }}'
        then:
        - target:
            entity_id: '{{ repeat.item }}'
          data:
            transition: 10
            brightness_pct: '{{ states(''input_number.night_light_brightness'') }}'
          continue_on_error: true
          action: light.turn_on
        - delay: 2
  - parallel:
    - if:
      - condition: state
        entity_id: light.powder_room_pendant_light_entity
        state: 'on'
      then:
      - data:
          transition: 10
          brightness_pct: '{{ states(''input_number.night_light_brightness'') }}'
        target:
          entity_id: light.powder_room_pendant_light_entity
        continue_on_error: true
        action: light.turn_on
    - repeat:
        for_each:
        - light.junior_bathroom_ceiling_light_entity
        - light.junior_bathroom_pendant_light_entity
        sequence:
        - if:
          - condition: template
            value_template: '{{ is_state(repeat.item, ''on'') }}'
          then:
          - target:
              entity_id: '{{ repeat.item }}'
            data:
              transition: 10
              brightness_pct: '{{ states(''input_number.night_light_brightness'')
                }}'
            continue_on_error: true
            action: light.turn_on
          - delay: 2
  mode: single
- id: '1674045954399'
  alias: Lights for Sleep Hours Start
  description: Set the lights for Sleep Hours Start
  triggers:
  - at: input_datetime.sleep_hours_start
    trigger: time
  conditions: []
  actions:
  - repeat:
      for_each:
      - light.elis_room_bulb_1_entity
      - light.elis_room_bulb_2_entity
      - light.elis_room_bulb_3_entity
      sequence:
      - if:
        - condition: template
          value_template: '{{ is_state(repeat.item, ''on'') }}'
        then:
        - target:
            entity_id: '{{ repeat.item }}'
          continue_on_error: true
          action: light.turn_off
          data:
            transition: 10
        - delay: 2
  - repeat:
      for_each:
      - light.elenas_room_bulb_1_entity
      - light.elenas_room_bulb_2_entity
      - light.elenas_room_bulb_3_entity
      sequence:
      - if:
        - condition: template
          value_template: '{{ is_state(repeat.item, ''on'') }}'
        then:
        - target:
            entity_id: '{{ repeat.item }}'
          continue_on_error: true
          action: light.turn_off
          data:
            transition: 10
        - delay: 2
  mode: single
- id: '1675045598043'
  alias: Junior Bathroom Occupancy
  description: Track occupancy in the Junior Bathroom based on Wasp in a Box logic
  use_blueprint:
    path: AlexanderBabel/occupancy.yaml
    input:
      motion_sensor: binary_sensor.junior_bathroom_motion_sensors
      occupancy_helper: input_boolean.junior_bathroom_occupancy
      last_motion_helper: input_datetime.junior_bathroom_last_motion_detected
      turn_off_delay: 90
      door_sensor: binary_sensor.junior_bathroom_door
- id: '1675045768564'
  alias: Powder Room Occupancy
  description: Track occupancy in the Powder Room based on Wasp in a Box logic
  use_blueprint:
    path: AlexanderBabel/occupancy.yaml
    input:
      door_sensor: binary_sensor.powder_room_door
      motion_sensor: binary_sensor.powder_room_motion
      occupancy_helper: input_boolean.powder_room_occupancy
      last_motion_helper: input_datetime.powder_room_last_motion_detected
- id: '1675045803046'
  alias: Master Bathroom Occupancy
  description: Track occupancy in the Master Bathroom based on Wasp in a Box logic
  use_blueprint:
    path: AlexanderBabel/occupancy.yaml
    input:
      door_sensor: binary_sensor.master_bathroom_door
      motion_sensor: binary_sensor.master_bathroom_motion_sensors
      occupancy_helper: input_boolean.master_bathroom_occupancy
      last_motion_helper: input_datetime.master_bathroom_last_motion_detected
      turn_off_delay: 90
- id: '1676814581353'
  alias: Notify When Holiday Upcoming
  description: Send notifications to apps when school or public holidays are upcoming
  triggers:
  - alias: When Elena's next school holiday is less than time threshold for advance
      reminder
    value_template: '{{ (state_attr(''calendar.elena_no_school'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 5 | int(7)) }}'
    id: calendar.elena_no_school
    trigger: template
  - value_template: '{{ (state_attr(''calendar.elena_no_school'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 1) }}'
    alias: When Elena's next school holiday is tomorrow
    id: calendar.elena_no_school
    trigger: template
  - alias: When Eli's next school holiday is less than time threshold for advance
      reminder
    value_template: '{{ (state_attr(''calendar.eli_no_school'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 5 | int(7)) }}'
    id: calendar.eli_no_school
    trigger: template
  - value_template: '{{ (state_attr(''calendar.eli_no_school'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 1) }}'
    id: calendar.eli_no_school
    alias: When Eli's next school holiday is tomorrow
    trigger: template
  - alias: When the next public holiday is less than time threshold for advance reminder
    value_template: '{{ (state_attr(''calendar.public_holidays'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 5 | int(7)) }}'
    id: calendar.public_holidays
    trigger: template
  - value_template: '{{ (state_attr(''calendar.public_holidays'',''start_time'').split()[0]
      | as_datetime).date() - now().date() <= timedelta(days = 1) }}'
    id: calendar.public_holidays
    alias: When the next public holiday is tomorrow
    trigger: template
  conditions: []
  actions:
  - data:
      title: "{% set start_date = (state_attr(trigger.id,'start_time').split()[0]
        | as_datetime).date() %} {% set end_date = (state_attr(trigger.id,'end_time').split()[0]
        | as_datetime - timedelta(days=1)).date() %} {% if start_date == end_date
        %}\n  {{ start_date.strftime('%a %d %b %Y') }}\n{% else %}\n  {{ start_date.strftime('%a
        %d %b %Y') }} to {{ end_date.strftime('%a %d %b %Y') }}\n{% endif %}"
      message: '{% set preamble = {''calendar.elena_no_school'': ''Elena has no school'',
        ''calendar.eli_no_school'': ''Eli has no school'', ''calendar.public_holidays'':
        ''Public holiday''} %} {{ preamble[trigger.id] }} due to {{ state_attr(trigger.id,''message'')
        }}.'
    action: notify.mobile_app_grace
  - data:
      title: "{% set start_date = (state_attr(trigger.id,'start_time').split()[0]
        | as_datetime).date() %} {% set end_date = (state_attr(trigger.id,'end_time').split()[0]
        | as_datetime - timedelta(days=1)).date() %} {% if start_date == end_date
        %}\n  {{ start_date.strftime('%a %d %b %Y') }}\n{% else %}\n  {{ start_date.strftime('%a
        %d %b %Y') }} to {{ end_date.strftime('%a %d %b %Y') }}\n{% endif %}"
      message: '{% set preamble = {''calendar.elena_no_school'': ''Elena has no school'',
        ''calendar.eli_no_school'': ''Eli has no school'', ''calendar.public_holidays'':
        ''Public holiday''} %} {{ preamble[trigger.id] }} due to {{ state_attr(trigger.id,''message'')
        }}.'
    action: notify.mobile_app_aurora
  mode: parallel
- id: '1677851042764'
  alias: Parents' Room Motion Timeout
  description: Turn off the Parents' Room Lights, Fan, AC and AC Auto Control if no
    motion is detected for timeout period
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor: binary_sensor.parents_room_presence
      number_of_minutes_doors_closed: input_number.motion_timeout_bedrooms
      doors_list:
      - binary_sensor.parents_room_door
      - binary_sensor.master_bathroom_door
      turnoff_entities_list:
      - light.parents_room_lights
      - fan.parents_room_fan
      - climate.parents_room_ac
      - light.parents_room_bedside_lamp
- id: '1677899246051'
  alias: Parents' Room Motion Fan
  description: Turn on the Parents' Room Fan depending on whether the doors are open
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.parents_room_presence
      fan: fan.parents_room_fan
      entities_list:
      - light.parents_room_lights
      - fan.parents_room_fan
      - climate.parents_room_ac
      doors_list:
      - binary_sensor.parents_room_door
      - binary_sensor.master_bathroom_door
- id: '1677902645887'
  alias: Parents' Room Motion AC
  description: Control the Parents' Room AC when motion is detected depending on whether
    the doors are open
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.parents_room_presence
      ac: climate.parents_room_ac
      entities_list:
      - light.parents_room_lights
      - fan.parents_room_fan
      - climate.parents_room_ac
- id: '1677905626060'
  alias: Parents' Room Motion Lights
  description: Set the Parents' Room Lights when motion is detected, at least one
    door is open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.parents_room_lights
      motion_sensor: binary_sensor.parents_room_presence
      lux_sensor: sensor.parents_room_lux
      entities_list:
      - light.parents_room_lights
      - fan.parents_room_fan
      - climate.parents_room_ac
      - light.parents_room_core_led_strips
      doors_list:
      - binary_sensor.parents_room_door
      - binary_sensor.master_bathroom_door
      blackout_hours_start: input_datetime.wind_down
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1677909386904'
  alias: Elena's Room Motion AC
  description: Control Elena's Room AC when motion is detected depending on whether
    the doors are open
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.elenas_room_presence
      ac: climate.elenas_room_ac
      entities_list:
      - light.elenas_room_lights
      - fan.elenas_room_fan
      - climate.elenas_room_ac
- id: '1677909480401'
  alias: Elena's Room Motion Fan
  description: Turn on Elena's Room Fan depending on whether the doors are open
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.elenas_room_presence
      fan: fan.elenas_room_fan
      entities_list:
      - light.elenas_room_lights
      - fan.elenas_room_fan
      - climate.elenas_room_ac
      doors_list:
      - binary_sensor.elenas_room_door
- id: '1677909588511'
  alias: Elena's Room Motion Lights
  description: Set Elena's Room Lights when motion is detected, at least one door
    is open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.elenas_room_lights
      motion_sensor: binary_sensor.elenas_room_presence
      lux_sensor: sensor.elenas_room_lux
      entities_list:
      - light.elenas_room_lights
      - fan.elenas_room_fan
      - climate.elenas_room_ac
      doors_list:
      - binary_sensor.elenas_room_door
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1677909662437'
  alias: Elena's Room Motion Timeout
  description: Turn off Elena's Room Lights, Fan, AC and AC Auto Control if no motion
    is detected for timeout period
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor: binary_sensor.elenas_room_presence
      number_of_minutes_doors_closed: input_number.motion_timeout_bedrooms
      doors_list:
      - binary_sensor.elenas_room_door
      turnoff_entities_list:
      - light.elenas_room_lights
      - fan.elenas_room_fan
      - climate.elenas_room_ac
      - light.elenas_room_bedside_lamp
- id: '1677909834890'
  alias: Eli's Room Motion AC
  description: Control Eli's Room AC when motion is detected depending on whether
    the doors are open
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.elis_room_presence
      ac: climate.elis_room_ac
      entities_list:
      - light.elis_room_lights
      - fan.elis_room_fan
      - climate.elis_room_ac
- id: '1677909930165'
  alias: Eli's Room Motion Fan
  description: Turn on Eli's Room Fan depending on whether the doors are open
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.elis_room_presence
      fan: fan.elis_room_fan
      entities_list:
      - light.elis_room_lights
      - fan.elis_room_fan
      - climate.elis_room_ac
      doors_list:
      - binary_sensor.elis_room_door
- id: '1677910041263'
  alias: Eli's Room Motion Lights
  description: Set Eli's Room Lights when motion is detected, at least one door is
    open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.elis_room_lights
      motion_sensor: binary_sensor.elis_room_presence
      lux_sensor: sensor.elis_room_lux
      entities_list:
      - light.elis_room_lights
      - fan.elis_room_fan
      - climate.elis_room_ac
      doors_list:
      - binary_sensor.elis_room_door
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1677910111088'
  alias: Eli's Room Motion Timeout
  description: Turn off Eli's Room Lights, Fan, AC and AC Auto Control if no motion
    is detected for timeout period
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor: binary_sensor.elis_room_presence
      number_of_minutes_doors_closed: input_number.motion_timeout_bedrooms
      doors_list:
      - binary_sensor.elis_room_door
      turnoff_entities_list:
      - light.elis_room_lights
      - fan.elis_room_fan
      - climate.elis_room_ac
      - light.elis_room_floor_lamp
- id: '1677927683160'
  alias: Kitchen Motion Lights
  description: Set Kitchen Lights when motion is detected, depending on lux level
    and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.kitchen_lights
      motion_sensor: binary_sensor.kitchen_radar_occupancy
      lux_sensor: sensor.kitchen_radar_lux
      lights_debounce: false
- id: '1677927981807'
  alias: Kitchen Motion Timeout
  description: Turn off Kitchen Lights when no motion is detected for a certain amount
    of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.kitchen_radar_occupancy
      turnoff_entities_list:
      - light.kitchen_lights
- id: '1678321703771'
  alias: Study Walkway Motion Light
  description: Control Study Room Bulb 4 when motion is detected, depending on lux
    level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.study_room_bulb_4_entity
      motion_sensor: binary_sensor.study_walkway_motion
      lux_sensor: sensor.study_walkway_lux
      entities_list:
      - light.study_room_bulb_2_entity
      - light.study_room_bulb_3_entity
      - light.study_room_bulb_1_entity
- id: '1678322492101'
  alias: Study Walkway Motion Timeout
  description: Turn off Study Room Bulb 4 when no motion is detected for a certain
    amount of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.study_walkway_motion
      entities_list:
      - light.study_room_bulb_2_entity
      - light.study_room_bulb_3_entity
      - light.study_room_bulb_1_entity
      turnoff_entities_list:
      - light.study_room_bulb_4_entity
- id: '1678322978006'
  alias: Playroom Motion Lights
  description: Control the Playroom Lights when motion is detected, depending on lux
    level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.playroom_lights
      motion_sensor: binary_sensor.playroom_presence
      lux_sensor: sensor.playroom_radar_lux
      lights_debounce: false
- id: '1678323081528'
  alias: Playroom Motion Timeout
  description: Turn off Playroom Lights when no motion is detected for a certain amount
    of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.playroom_presence
      turnoff_entities_list:
      - light.playroom_lights
- id: '1678323204367'
  alias: Yard Motion Light
  description: Control the Yard Light when motion is detected, depending on lux level
    and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.yard_light_entity
      motion_sensor: binary_sensor.yard_motion
      lux_sensor: sensor.playroom_radar_lux
      lights_debounce: false
- id: '1678323253914'
  alias: Yard Motion Timeout
  description: Turn off the Yard Light when no motion is detected for a certain amount
    of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.yard_motion
      turnoff_entities_list:
      - light.yard_light_entity
- id: '1679619343225'
  alias: Living Room Motion Lights
  description: Control the Living Room Lights when motion is detected, depending on
    lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.living_room_lights
      motion_sensor: binary_sensor.living_room_presence
      lux_sensor: sensor.study_walkway_lux
      blackout_hours_start: input_datetime.dim_hours_start
      lights_debounce: false
- id: '1679619511575'
  alias: Living Room Motion Pendant Light
  description: Control the Living Room Pendant Light when motion is detected, depending
    on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.living_room_pendant_light_entity
      motion_sensor: binary_sensor.living_room_presence
      lux_sensor: sensor.study_walkway_lux
      blackout_hours_start: input_datetime.dim_hours_end
      doors_list: []
      lights_debounce: true
- id: '1679619704393'
  alias: Living Room Motion Timeout
  description: Turn off lights, fan and AC in the Living Room when no motion is detected
    for the long timeout.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor: binary_sensor.living_room_presence
      turnoff_entities_list:
      - light.living_room_lights
      - light.living_room_pendant_light_entity
      - fan.living_room_fan
      - climate.living_room_ac
      entities_list:
      - input_boolean.party_mode
- id: '1679619826696'
  alias: Dining Room Motion Lights
  description: Control the Dining Room Lights when motion is detected, depending on
    lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.dining_room_lights
      motion_sensor: binary_sensor.dining_room_presence
      lux_sensor: sensor.study_walkway_lux
      blackout_hours_start: input_datetime.dim_hours_start
      lights_debounce: false
- id: '1679619906548'
  alias: Dining Room Motion Pendant Light
  description: Control the Dining Room Pendant Light when motion is detected, depending
    on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.dining_room_pendant_light_entity
      motion_sensor: binary_sensor.dining_room_presence
      lux_sensor: sensor.study_walkway_lux
      doors_list: []
      blackout_hours_start: input_datetime.dim_hours_end
- id: '1679619971749'
  alias: Dining Room Motion Timeout
  description: Turn off lights, fan and AC in the Dining Room when no motion is detected
    for the long timeout.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.dining_room_presence
      turnoff_entities_list:
      - light.dining_room_lights
      - light.dining_room_pendant_light_entity
      - fan.dining_room_fan
      - climate.dining_room_ac
      entities_list:
      - input_boolean.party_mode
- id: '1679620287237'
  alias: Living Room Motion Fan
  description: Control the Living Room Fan when motion is detected, depending on whether
    the doors are open.
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.living_room_presence
      fan: fan.living_room_fan
      entities_list:
      - light.living_room_lights
      - light.living_room_pendant_light_entity
      - fan.living_room_fan
      - climate.living_room_ac
      doors_list:
      - binary_sensor.elenas_room_door
      - binary_sensor.elis_room_door
      - binary_sensor.junior_bathroom_door
      - binary_sensor.parents_room_door
      - binary_sensor.powder_room_door
      - binary_sensor.main_door
      respect_closed_doors: false
      off_hours_start: input_datetime.sleep_hours_start
- id: '1679620425571'
  alias: Dining Room Motion Fan
  description: Control the Dining Room Fan when motion is detected, depending on whether
    the doors are open.
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.dining_room_presence
      fan: fan.dining_room_fan
      doors_list:
      - binary_sensor.elenas_room_door
      - binary_sensor.elis_room_door
      - binary_sensor.junior_bathroom_door
      - binary_sensor.powder_room_door
      - binary_sensor.parents_room_door
      - binary_sensor.main_door
      entities_list:
      - light.dining_room_lights
      - light.dining_room_pendant_light_entity
      - climate.dining_room_ac
      - fan.dining_room_fan
      respect_closed_doors: false
      off_hours_start: input_datetime.sleep_hours_start
- id: '1679732114538'
  alias: Dishwasher Auto Control
  description: Turn on or off the dishwasher based on door state and idle time
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.dishwasher_door
    to: 'off'
    id: door_closed
  - platform: template
    value_template: '{{ is_state(''switch.dishwasher'',''on'') and states(''sensor.dishwasher_watts'')
      | float(0) <= 3 }}'
    for:
      hours: 0
      minutes: 15
      seconds: 0
    id: idle
  condition: []
  action:
  - if:
    - condition: trigger
      id: door_closed
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.dishwasher
    else:
    - service: switch.turn_off
      data: {}
      target:
        entity_id: switch.dishwasher
  mode: single
- id: '1679819939741'
  alias: Dining Room Motion AC
  description: Control the Dining Room AC when motion is detected, depending on whether
    the doors are closed.
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.dining_room_presence
      ac: climate.dining_room_ac
      entities_list:
      - light.dining_room_lights
      - fan.dining_room_fan
      - climate.dining_room_ac
      - light.dining_room_pendant_light_entity
      respect_closed_doors: false
      off_hours_start: input_datetime.sleep_hours_start
- id: '1679820093028'
  alias: Living Room Motion AC
  description: Control the Living Room AC when motion is detected, depending on whether
    the doors are closed.
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.living_room_presence
      ac: climate.living_room_ac
      entities_list:
      - light.living_room_lights
      - light.living_room_pendant_light_entity
      - fan.living_room_fan
      - climate.living_room_ac
      respect_closed_doors: false
      off_hours_start: input_datetime.sleep_hours_start
- id: '1681034852325'
  alias: Study Room Motion Fan
  description: Control the Study Room Fan when motion is detected
  use_blueprint:
    path: danleongjy/motion_fan.yaml
    input:
      motion_sensor: binary_sensor.study_room_radar_occupancy
      fan: fan.study_room_fan
      entities_list:
      - fan.study_room_fan
      - climate.study_room_ac
      - light.study_room_bulb_2_entity
      - light.study_room_bulb_3_entity
      doors_list:
      - binary_sensor.elenas_room_door
      - binary_sensor.elis_room_door
      - binary_sensor.junior_bathroom_door
      - binary_sensor.parents_room_door
      - binary_sensor.powder_room_door
      - binary_sensor.main_door
      respect_closed_doors: false
- id: '1681731968251'
  alias: Hallway Motion Lights
  description: Control the Hallway Lights when motion is detected, depending on lux
    level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.hallway_lights
      motion_sensor: binary_sensor.hallway_motion
      lux_sensor: sensor.hallway_lux
      lights_debounce: false
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1681735193653'
  alias: Party Mode
  description: Set recommended scenes in public areas and prevent lights dimming when
    Party Mode is on
  triggers:
  - entity_id:
    - input_boolean.party_mode
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.party_mode
      state: 'on'
    then:
    - data:
        time: '{{ states(''input_datetime.dim_hours_end'') }}'
      target:
        entity_id: input_datetime.dim_hours_start
      action: input_datetime.set_datetime
    - delay: 1
    - action: homeassistant.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - automation.kitchen_voice_assistant_listening_for_wake_word
        - automation.study_room_voice_assistant_listening_for_wake_word
        - switch.kitchen_core_use_wake_word
        - switch.study_room_voice_assistant_use_wake_word
    else:
    - action: homeassistant.turn_on
      target:
        entity_id:
        - automation.kitchen_voice_assistant_listening_for_wake_word
        - automation.study_room_voice_assistant_listening_for_wake_word
      data: {}
    - data:
        time: '{{ states(''input_datetime.wind_down'') }}'
      target:
        entity_id: input_datetime.dim_hours_start
      action: input_datetime.set_datetime
    - delay: 1
    - if:
      - condition: state
        entity_id: binary_sensor.kitchen_radar_occupancy
        state: 'on'
      then:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.kitchen_core_use_wake_word
    - if:
      - condition: state
        entity_id: binary_sensor.study_room_radar_occupancy
        state: 'on'
      then:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.study_room_voice_assistant_use_wake_word
  - repeat:
      for_each:
      - dining_room
      - living_room
      - study_room
      sequence:
      - data:
          room: '{{ [repeat.item] }}'
        action: script.set_recommended_scene
      - delay: 1
  mode: single
- id: '1681736538604'
  alias: Hallway Motion Timeout
  description: Turn off Hallway Lights when no motion is detected for a certain amount
    of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.hallway_motion
      number_of_minutes: input_number.motion_timeout_walking_areas
      turnoff_entities_list:
      - light.hallway_lights
- id: '1681781855944'
  alias: Study Room Motion AC
  description: Control the Study Room AC when motion is detected, depending on whether
    the doors are closed.
  use_blueprint:
    path: danleongjy/motion_ac.yaml
    input:
      motion_sensor: binary_sensor.study_room_radar_occupancy
      ac: climate.study_room_ac
      entities_list:
      - fan.study_room_fan
      - climate.study_room_ac
      - light.study_room_bulb_2_entity
      - light.study_room_bulb_3_entity
      respect_closed_doors: false
- id: '1681782121211'
  alias: Study Room Motion Lights
  description: Control the Study Room Lights when motion is detected, depending on
    lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.study_room_lights
      motion_sensor: binary_sensor.study_room_radar_occupancy
      lux_sensor: sensor.study_walkway_lux
      lights_debounce: false
      entities_list:
      - light.study_room_bulb_3_entity
- id: '1681782270863'
  alias: Study Room Motion Timeout
  description: Turn off Study Room Lights, Fan and AC when no motion is detected for
    a certain amount of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor: binary_sensor.study_room_radar_occupancy
      entities_list:
      - input_boolean.party_mode
      turnoff_entities_list:
      - light.study_room_lights
      - fan.study_room_fan
      - climate.study_room_ac
- id: '1684242432236'
  alias: Parents' Room Fan Auto Control
  description: Set the Parents' Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      fan: fan.parents_room_fan
      temp_sensor: sensor.parents_room_core_temperature
      high_temp: 29.2
      low_temp: 28.5
- id: '1684246531388'
  alias: Elena's Room Fan Auto Control
  description: Set Elena's Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      temp_sensor: sensor.elenas_room_core_temperature
      high_temp: 29
      fan: fan.elenas_room_fan
      high_speed: input_number.bedrooms_fan_speed_when_warm
      low_temp: 28
- id: '1684246574094'
  alias: Eli's Room Fan Auto Control
  description: Set the Eli's Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      fan: fan.elis_room_fan
      temp_sensor: sensor.elis_room_core_temperature
      high_temp: 29
- id: '1684314607182'
  alias: Dining Room Fan Auto Control
  description: Set the Dining Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      fan: fan.dining_room_fan
      temp_sensor: sensor.dining_room_temperature
      low_speed: input_number.sitting_rooms_fan_speed_when_cool
      high_speed: input_number.sitting_rooms_fan_speed_when_warm
      low_temp: 28
      high_temp: 28.5
- id: '1684314664733'
  alias: Living Room Fan Auto Control
  description: Set the Living Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      fan: fan.living_room_fan
      temp_sensor: sensor.dining_room_temperature
      low_speed: input_number.sitting_rooms_fan_speed_when_cool
      high_speed: input_number.sitting_rooms_fan_speed_when_warm
- id: '1684314715221'
  alias: Study Room Fan Auto Control
  description: Set the Study Room Fan speed and direction based on temperature
  use_blueprint:
    path: danleongjy/fan_auto_control.yaml
    input:
      fan: fan.study_room_fan
      temp_sensor: sensor.study_room_temperature
      low_speed: input_number.sitting_rooms_fan_speed_when_cool
      high_speed: input_number.sitting_rooms_fan_speed_when_warm
- id: '1685098214703'
  alias: Notify When Kitchen Appliances On while Away
  description: Send a notification if the Rice Cooker or Stove is on when Away Mode
    is active.
  trigger:
  - platform: state
    entity_id:
    - input_boolean.away_mode
    - switch.stove_main_power
    - binary_sensor.rice_cooker
  condition: []
  action:
  - if:
    - condition: state
      entity_id: input_boolean.away_mode
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: switch.stove_main_power
        state: 'on'
      - condition: state
        entity_id: binary_sensor.rice_cooker
        state: 'on'
    then:
    - service: notify.mobile_app_aurora
      data:
        title: Turn off kitchen appliances?
        data:
          tag: appliances_on
        message: "{% if is_state('binary_sensor.rice_cooker', 'on')  and is_state('switch.stove_main_power',
          'on') %}\n  Rice cooker and stove are on.\n{% elif is_state('binary_sensor.rice_cooker',
          'on') %}\n  Rice cooker is on.\n{% else %}\n  Stove is on.\n{% endif %}"
    - service: notify.mobile_app_grace
      data:
        title: Turn off kitchen appliances?
        data:
          tag: appliances_on
        message: "{% if is_state('binary_sensor.rice_cooker', 'on')  and is_state('switch.stove_main_power',
          'on') %}\n  Rice cooker and stove are on.\n{% elif is_state('binary_sensor.rice_cooker',
          'on') %}\n  Rice cooker is on.\n{% else %}\n  Stove is on.\n{% endif %}"
    else:
    - service: notify.mobile_app_aurora
      data:
        message: clear_notification
        data:
          tag: appliances_on
    - service: notify.mobile_app_grace
      data:
        message: clear_notification
        data:
          tag: appliances_on
  mode: single
  max_exceeded: silent
- id: '1659256881015'
  alias: Kitchen Blind Controller
  description: Control the Kitchen Blind
  use_blueprint:
    path: EPMatt/ikea_e1766.yaml
    input:
      integration: ZHA
      controller_device: 63ca2b52933039d3f01175d8c06dd220
      helper_last_controller_event: input_text.zz_kitchen_blind_controller_last_event
      action_button_up_short:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.kitchen_blind
          command: cover_open
      action_button_down_short:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.kitchen_blind
          command: cover_close
      action_button_up_double:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.kitchen_blind
          command: cover_auto_control
      action_button_down_double:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.kitchen_blind
          command: cover_manual_control
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 500
- id: '1659777667257'
  alias: Kitchen Blind Auto Control
  description: Close the Kitchen Blind if raining, in the mornings or AC is on
  triggers:
  - value_template: "{{ (states('sensor.local_rainfall') | int(0) > 1)\n   or ('Thunder'
      in states('sensor.local_two_hour_forecast'))\n   or ('Rain' in states('sensor.local_two_hour_forecast'))\n
      \  or ('Wind' in states('sensor.local_two_hour_forecast')) }}"
    trigger: template
  - entity_id:
    - climate.living_room_ac
    - climate.dining_room_ac
    to: cool
    trigger: state
  - entity_id:
    - switch.stove_main_power
    - switch.rice_cooker
    not_from:
    - unavailable
    - unknown
    not_to:
    - unavailable
    - unknown
    trigger: state
  - entity_id:
    - sensor.kitchen_radar_lux
    trigger: state
  - entity_id:
    - binary_sensor.kitchen_radar_occupancy
    to: 'on'
    trigger: state
  - entity_id: sensor.sun_solar_elevation
    trigger: state
  - entity_id: sensor.sun_solar_azimuth
    trigger: state
  - entity_id:
    - sun.sun
    attribute: rising
    to: false
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: template
          value_template: "{{ (states('sensor.local_rainfall') | int(0) > 1)\n   or
            ('Thunder' in states('sensor.local_two_hour_forecast'))\n   or ('Rain'
            in states('sensor.local_two_hour_forecast'))\n   or ('Showers' in states('sensor.local_two_hour_forecast'))\n
            \  or ('Wind' in states('sensor.local_two_hour_forecast')) }}"
        - condition: state
          entity_id: climate.living_room_ac
          state: cool
        - condition: state
          entity_id: climate.dining_room_ac
          state: cool
      - condition: not
        conditions:
        - condition: state
          entity_id:
          - switch.stove_main_power
          - switch.rice_cooker
          state: 'on'
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.kitchen_blind
          attribute: current_position
          state: 0
      - data: {}
        target:
          entity_id: cover.kitchen_blind
        action: cover.close_cover
    - conditions:
      - condition: numeric_state
        entity_id: sensor.sun_solar_elevation
        above: 1
        below: 65
      - condition: numeric_state
        entity_id: sensor.sun_solar_azimuth
        below: 105
        above: 45
      sequence:
      - condition: template
        value_template: '{{ now() - states[''cover.kitchen_blind''].last_changed >
          timedelta(minutes = states(''input_number.blinds_auto_control_debounce'')
          | int(0)) }}'
      - condition: not
        conditions:
        - condition: state
          entity_id: cover.kitchen_blind
          attribute: current_position
          state: 15
      - data:
          position: 15
        target:
          entity_id: cover.kitchen_blind
        action: cover.set_cover_position
    default:
    - condition: and
      conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: sun.sun
          attribute: rising
          state: false
          enabled: true
        - condition: numeric_state
          entity_id: sun.sun
          above: '65'
          attribute: elevation
          enabled: true
        - condition: state
          entity_id: switch.stove_main_power
          state: 'on'
        - condition: numeric_state
          entity_id: sensor.kitchen_radar_lux
          below: input_number.minimum_lux
        - condition: state
          entity_id: switch.rice_cooker
          state: 'on'
        - condition: numeric_state
          entity_id: sensor.sun_solar_azimuth
          above: 105
        - condition: numeric_state
          entity_id: sensor.sun_solar_azimuth
          below: 45
      - condition: not
        conditions:
        - condition: template
          value_template: "{{ (states('sensor.local_rainfall') | int(0) > 1)\n   or
            ('Thunder' in states('sensor.local_two_hour_forecast'))\n   or ('Rain'
            in states('sensor.local_two_hour_forecast'))\n   or ('Showers' in states('sensor.local_two_hour_forecast'))\n
            \  or ('Wind' in states('sensor.local_two_hour_forecast')) }}"
      - condition: not
        conditions:
        - condition: template
          value_template: "{{ states('sun.sun') == 'above_horizon'\n   and state_attr('sun.sun',
            'elevation') <= 60\n   and state_attr('sun.sun', 'azimuth') >= 45\n   and
            state_attr('sun.sun', 'azimuth') <= 105 }}"
    - condition: template
      value_template: '{{ now() - states[''cover.kitchen_blind''].last_changed > timedelta(minutes
        = states(''input_number.blinds_auto_control_debounce'') | int(0)) }}'
    - condition: not
      conditions:
      - condition: state
        entity_id: cover.kitchen_blind
        attribute: current_position
        state: 100
    - data: {}
      target:
        entity_id: cover.kitchen_blind
      action: cover.open_cover
  mode: single
  max_exceeded: silent
- id: '1690717352582'
  alias: Daniel's Alarm
  description: Wake up Daniel at his next alarm
  triggers:
  - at: input_datetime.daniels_next_alarm
    trigger: time
    id: alarm
  - trigger: state
    entity_id:
    - binary_sensor.parents_room_doors
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - alarm
    then:
    - if:
      - condition: state
        entity_id: input_boolean.parents_room_next_alarm_armed
        state: 'on'
      then:
      - target:
          entity_id: light.parents_room_core_display_backlight
        data:
          brightness_pct: '{{ states(''input_number.morning_light_brightness'') |
            int if is_state(''sun.sun'',''below_horizon'') else 100 }}'
        action: light.turn_on
      - data:
          option: Eli's Song
        target:
          entity_id: select.parents_room_core_ringtone
        action: select.select_option
      - action: number.set_value
        target:
          entity_id: number.parents_room_core_speaker_volume
        data:
          value: 10
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
    - delay:
        hours: 0
        minutes: 5
        seconds: 0
        milliseconds: 0
    - if:
      - condition: state
        entity_id: input_boolean.parents_room_next_alarm_armed
        state: 'on'
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.aurora_battery_state
          state: discharging
      then:
      - data:
          bedroom: parents_room
          ringtone: Eli's Song
        action: script.alarm_lights
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
      data: {}
    else:
    - condition: state
      entity_id: sensor.next_alarm_timings
      attribute: daniel_next_alarm_dismissable
      state: true
    - condition: time
      after: input_datetime.daniels_next_alarm
    - action: input_boolean.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
  mode: parallel
  max: 2
- id: '1690718460853'
  alias: Notify When Parents' Room Next Alarm Upcoming
  description: Send an actionable notification when Parents' Room Next Alarm is imminent,
    allowing dismissal of the alarm.
  trigger:
  - platform: state
    entity_id:
    - sensor.next_alarm_timings
    attribute: parents_room_next_alarm_dismissable
    from: false
    to: true
  condition: []
  action:
  - service: notify.mobile_app_aurora
    data:
      message: Upcoming alarm at {{ state_attr('sensor.next_alarm_timings','parents_room').split('
        ')[1][:5] }}
      data:
        clickAction: /lovelace/settings-sleep
        actions:
        - action: dismiss
          title: Dismiss Alarm
        - action: continue
          title: Continue Alarm
  - wait_for_trigger:
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: dismiss
      context:
        user_id:
        - ad2bcce775894550affb6dfef93a2a36
    - platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: continue
      context:
        user_id:
        - ad2bcce775894550affb6dfef93a2a36
    timeout:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
    continue_on_timeout: false
  - if:
    - condition: template
      value_template: '{{ wait.trigger.event.data.action == ''dismiss'' }}'
    then:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
    else:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
  mode: single
- id: '1690814237442'
  alias: Eli's Next Alarm
  description: Set Eli's Next Alarm to the next day where he has school
  triggers:
  - value_template: '{{ now() > as_datetime(states(''input_datetime.elis_next_alarm'')).astimezone(now().tzinfo)
      + timedelta(minutes = 1) }}'
    alias: When Eli's Alarm has fired
    id: alarm_fired
    trigger: template
  - entity_id:
    - input_datetime.eca_day_alarm
    - input_datetime.elis_school_day_alarm
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - alarm_fired
    then:
    - data:
        date: '{{ (now() - timedelta(days = 1)).date() }}'
      target:
        entity_id: input_datetime.elis_next_alarm
      action: input_datetime.set_datetime
    - data:
        alarm_datetime: input_datetime.elis_next_alarm
        calendars:
        - calendar.eli_school_days
      action: script.increment_alarm_day
  - choose:
    - conditions:
      - alias: Next alarm is on a weekday
        condition: template
        value_template: '{{ as_datetime(states(''input_datetime.elis_next_alarm'')).weekday()
          < 5 }}'
      sequence:
      - data:
          time: '{{ states(''input_datetime.elis_school_day_alarm'') }}'
        target:
          entity_id: input_datetime.elis_next_alarm
        action: input_datetime.set_datetime
      - if:
        - condition: template
          value_template: '{{ as_datetime(states(''input_datetime.elis_next_alarm'')).weekday()
            in [0,3] }}'
          alias: If today is a Mon or Thu
        then:
        - data:
            time: '{{ ((states(''input_datetime.elis_next_alarm'') | as_datetime)
              - timedelta(minutes = 10)).time() }}'
          target:
            entity_id: input_datetime.elis_next_alarm
          action: input_datetime.set_datetime
    default:
    - data:
        time: '{{ states(''input_datetime.eca_day_alarm'') }}'
      target:
        entity_id: input_datetime.elis_next_alarm
      action: input_datetime.set_datetime
  mode: single
  max_exceeded: silent
- id: '1690814722057'
  alias: Elena's Next Alarm
  description: Set Elena's Next Alarm to the next day where she has school
  trigger:
  - platform: template
    value_template: '{{ now() > as_datetime(states(''input_datetime.elenas_next_alarm'')).astimezone(now().tzinfo)
      + timedelta(minutes = 1) }}'
    alias: When Elena's Alarm has fired
    id: alarm_fired
  - platform: state
    entity_id:
    - input_datetime.eca_day_alarm
    - input_datetime.elenas_school_day_alarm
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - alarm_fired
    then:
    - service: input_datetime.set_datetime
      data:
        date: '{{ (now() - timedelta(days = 1)).date() }}'
      target:
        entity_id: input_datetime.elenas_next_alarm
    - service: script.increment_alarm_day
      data:
        alarm_datetime: input_datetime.elenas_next_alarm
        calendars:
        - calendar.elena_school_days
  - if:
    - condition: template
      value_template: '{{ as_datetime(states(''input_datetime.elenas_next_alarm'')).weekday()
        < 5 }}'
      alias: If next alarm is on a weekday
    then:
    - service: input_datetime.set_datetime
      data:
        time: '{{ states(''input_datetime.elenas_school_day_alarm'') }}'
      target:
        entity_id: input_datetime.elenas_next_alarm
    else:
    - service: input_datetime.set_datetime
      data:
        time: '{{ states(''input_datetime.eca_day_alarm'') }}'
      target:
        entity_id: input_datetime.elenas_next_alarm
  mode: single
  max_exceeded: silent
- id: '1690850022345'
  alias: Grace's Alarm
  description: Wake up Grace at her next alarm
  triggers:
  - at: input_datetime.graces_next_alarm
    id: alarm
    trigger: time
  - entity_id:
    - binary_sensor.parents_room_doors
    from: 'off'
    to: 'on'
    id: dismiss_alarm
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - alarm
    then:
    - if:
      - condition: state
        entity_id: input_boolean.parents_room_next_alarm_armed
        state: 'on'
      then:
      - target:
          entity_id: light.parents_room_core_display_backlight
        data:
          brightness_pct: '{{ states(''input_number.morning_light_brightness'') |
            int if is_state(''sun.sun'',''below_horizon'') else 100 }}'
        action: light.turn_on
      - data:
          option: Beep
        target:
          entity_id: select.parents_room_core_ringtone
        action: select.select_option
      - action: number.set_value
        target:
          entity_id: number.parents_room_core_speaker_volume
        data:
          value: 10
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
      - delay: 1
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
      - delay: 1
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
      - delay: 1
      - data:
          option: Negative Beep
        target:
          entity_id: select.parents_room_core_ringtone
        action: select.select_option
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
    - delay: 300
    - if:
      - condition: state
        entity_id: input_boolean.parents_room_next_alarm_armed
        state: 'on'
      then:
      - data:
          bedroom: parents_room
          ringtone: Take On Me
        action: script.alarm_lights
      - data:
          option: Take On Me
        target:
          entity_id: select.parents_room_core_ringtone
        action: select.select_option
      - data: {}
        target:
          entity_id: button.parents_room_core_play_ringtone
        action: button.press
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
      data: {}
    else:
    - condition: state
      entity_id: sensor.next_alarm_timings
      attribute: grace_next_alarm_dismissable
      state: true
    - condition: time
      after: input_datetime.graces_next_alarm
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.parents_room_next_alarm_armed
      action: input_boolean.turn_off
  mode: parallel
  max: 2
- id: '1690850158819'
  alias: Eli's Alarm
  description: Wake up Eli at his next alarm
  triggers:
  - at: input_datetime.elis_next_alarm
    trigger: time
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.elis_room_next_alarm_armed
      state: 'on'
    then:
    - data:
        bedroom: elis_room
        ringtone: Nyancat
      action: script.alarm_lights
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.elis_room_next_alarm_armed
    data: {}
  mode: single
- id: '1693121253660'
  alias: Live Bus Arrivals
  description: Update the live bus arrival timings from LTA Datamall for buses stopping
    nearby during operating hours
  triggers:
  - minutes: /1
    alias: update
    id: update
    trigger: time_pattern
  - trigger: numeric_state
    entity_id:
    - zone.schools_outer_perimeter
    - zone.paya_lebar_outer_perimeter
    - zone.church_of_our_lady_queen_of_peace_bus_stop
    - zone.opposite_lorong_39_geylang_bus_stop
    - zone.paya_lebar_station_bus_stops
    - zone.acs_bus_stop
    - zone.marine_parade_outer_perimeter
    - zone.holy_family_church_bus_stop
    - zone.roxy_square_bus_stop
    - zone.parkway_parade_bus_stop
    - zone.kallang_station_outer_perimeter
    - zone.kallang_station_bus_stop
    - zone.telok_kurau
    - zone.newton_station_exit_c_bus_stop
    above: 0
    id: location_entered
  - trigger: numeric_state
    entity_id:
    - zone.schools_outer_perimeter
    - zone.paya_lebar_outer_perimeter
    - zone.church_of_our_lady_queen_of_peace_bus_stop
    - zone.opposite_lorong_39_geylang_bus_stop
    - zone.paya_lebar_station_bus_stops
    - zone.acs_bus_stop
    - zone.marine_parade_outer_perimeter
    - zone.holy_family_church_bus_stop
    - zone.roxy_square_bus_stop
    - zone.parkway_parade_bus_stop
    - zone.kallang_station_outer_perimeter
    - zone.kallang_station_bus_stop
    - zone.telok_kurau
    - zone.newton_station_exit_c_bus_stop
    id: location_exited
    below: 1
  conditions: []
  actions:
  - variables:
      locations:
        zone.kallang_station_outer_perimeter:
        - sensor.bus_stop_kallang_station
        zone.kallang_station_bus_stop:
        - sensor.bus_stop_kallang_station
        zone.paya_lebar_outer_perimeter:
        - sensor.bus_stop_church_of_our_lady_queen_of_peace
        - sensor.bus_stop_opposite_lorong_39_geylang
        - sensor.bus_stop_opposite_paya_lebar_square
        - sensor.bus_stop_paya_lebar_square
        zone.church_of_our_lady_queen_of_peace_bus_stop:
        - sensor.bus_stop_church_of_our_lady_queen_of_peace
        zone.opposite_lorong_39_geylang_bus_stop:
        - sensor.bus_stop_opposite_lorong_39_geylang
        zone.paya_lebar_station_bus_stops:
        - sensor.bus_stop_opposite_paya_lebar_square
        - sensor.bus_stop_paya_lebar_square
        zone.schools_outer_perimeter:
        - sensor.bus_stop_acs
        zone.acs_bus_stop:
        - sensor.bus_stop_acs
        zone.marine_parade_outer_perimeter:
        - sensor.bus_stop_holy_family_church
        - sensor.bus_stop_roxy_square
        - sensor.bus_stop_parkway_parade
        zone.holy_family_church_bus_stop:
        - sensor.bus_stop_holy_family_church
        zone.roxy_square_bus_stop:
        - sensor.bus_stop_roxy_square
        zone.parkway_parade_bus_stop:
        - sensor.bus_stop_parkway_parade
        zone.telok_kurau:
        - sensor.bus_stop_after_kampong_eunos
        - sensor.bus_stop_after_lorong_g_telok_kurau
        zone.newton_station_exit_c_bus_stop:
        - sensor.bus_stop_newton_station_exit_c
  - choose:
    - conditions:
      - condition: trigger
        id:
        - update
      sequence:
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.kallang_station_outer_perimeter'',''zone.kallang_station_bus_stop''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - action: homeassistant.update_entity
          metadata: {}
          data:
            entity_id:
            - sensor.bus_stop_kallang_station
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.church_of_our_lady_queen_of_peace_bus_stop'',''zone.opposite_lorong_39_geylang_bus_stop'',''zone.paya_lebar_outer_perimeter'',''zone.paya_lebar_station_bus_stops''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - repeat:
            sequence:
            - action: homeassistant.update_entity
              metadata: {}
              data:
                entity_id: '{{ repeat.item }}'
            for_each:
            - sensor.bus_stop_paya_lebar_square
            - sensor.bus_stop_opposite_paya_lebar_square
            - sensor.bus_stop_church_of_our_lady_queen_of_peace
            - sensor.bus_stop_opposite_lorong_39_geylang
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.acs_bus_stop'',''zone.schools_outer_perimeter''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - repeat:
            sequence:
            - action: homeassistant.update_entity
              metadata: {}
              data:
                entity_id: '{{ repeat.item }}'
            for_each:
            - sensor.bus_stop_acs
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.telok_kurau''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - repeat:
            sequence:
            - action: homeassistant.update_entity
              metadata: {}
              data:
                entity_id: '{{ repeat.item }}'
            for_each:
            - sensor.bus_stop_after_kampong_eunos
            - sensor.bus_stop_after_lorong_g_telok_kurau
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.newton_station_exit_c_bus_stop''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - repeat:
            sequence:
            - action: homeassistant.update_entity
              metadata: {}
              data:
                entity_id: '{{ repeat.item }}'
            for_each:
            - sensor.bus_stop_newton_station_exit_c
      - if:
        - condition: template
          value_template: '{{ states.zone | selectattr(''entity_id'',''in'',[''zone.holy_family_church_bus_stop'',''zone.parkway_parade_bus_stop'',''zone.roxy_square_bus_stop'',''zone.marine_parade_outer_perimeter''])
            | map(attribute = ''state'') | map(''int'') | list | sum > 0 }}'
        then:
        - repeat:
            sequence:
            - action: homeassistant.update_entity
              metadata: {}
              data:
                entity_id: '{{ repeat.item }}'
            for_each:
            - sensor.bus_stop_roxy_square
            - sensor.bus_stop_holy_family_church
            - sensor.bus_stop_parkway_parade
    - conditions:
      - condition: trigger
        id:
        - location_entered
        - location_exited
      sequence:
      - repeat:
          for_each: '{{ locations[trigger.entity_id] }}'
          sequence:
          - action: homeassistant.update_entity
            metadata: {}
            data:
              entity_id: '{{ repeat.item }}'
  mode: queued
- id: '1694229495079'
  alias: NEA Rain Radar Animation
  description: Update NEA Rain Radar Animation 5min past every hour if it is not during
    Sleep Hours
  trigger:
  - platform: time_pattern
    minutes: '5'
  condition:
  - condition: not
    conditions:
    - condition: time
      after: input_datetime.sleep_hours_start
      before: input_datetime.sleep_hours_end
  action:
  - service: script.nea_rain_radar_animation
    data: {}
  mode: single
- id: '1699176933163'
  alias: Junior Bathroom Motion Lights
  description: Control the Junior Bathroom lights when motion is detected, depending
    on lux level and time
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      motion_sensor: binary_sensor.junior_bathroom_occupancy
      lux_sensor: sensor.junior_shower_lux
      lights_list:
      - light.junior_bathroom_lights
- id: '1699177531859'
  alias: Junior Bathroom Motion Timeout
  description: Turn off Junior Bathroom Lights when no motion is detected for a certain
    amount of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.junior_bathroom_occupancy
      turnoff_entities_list:
      - light.junior_bathroom_lights
- id: '1699177618893'
  alias: Powder Room Motion Pendant Light
  description: Control the Powder Room Pendant Light when motion is detected, depending
    on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.powder_room_pendant_light_entity
      motion_sensor: binary_sensor.powder_room_occupancy
      lux_sensor: sensor.powder_room_lux
- id: '1699177686268'
  alias: Powder Room Motion Timeout
  description: Turn off Powder Room Pendant Light when no motion is detected for a
    certain amount of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.powder_room_occupancy
      turnoff_entities_list:
      - light.powder_room_pendant_light_entity
- id: '1699233038725'
  alias: Master Bathroom Motion Light
  description: Control the Master Bathroom Light when motion is detected, depending
    on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.master_bathroom_light_entity
      motion_sensor: binary_sensor.master_bathroom_motion
      lux_sensor: sensor.master_bathroom_lux
- id: '1699233080526'
  alias: Master Bathroom Motion Pendant Light
  description: Control the Master Bathroom Pendant Light when motion is detected,
    depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.master_bathroom_pendant_light_entity
      motion_sensor: binary_sensor.master_shower_motion
      lux_sensor: sensor.master_bathroom_lux
- id: '1699233249112'
  alias: Master Bathroom Motion Timeout
  description: Turn off Master Bathroom Lights when no motion is detected for a certain
    amount of time.
  use_blueprint:
    path: danleongjy/motion_timeout.yaml
    input:
      motion_sensor:
      - binary_sensor.master_bathroom_occupancy
      turnoff_entities_list:
      - light.master_bathroom_lights
- id: '1702255296989'
  alias: Eli's Room Core
  description: Interface between Eli's Room devices and Home Assistant via ESPHome
    and M5Stack Fire
  use_blueprint:
    path: danleongjy/room_core.yaml
    input:
      core_room: elis_room
      sleep_hours_start: input_datetime.sleep_hours_start
      sleep_hours_end: input_datetime.sleep_hours_end
      cover: cover.elis_room_curtains
- id: '1702256763571'
  alias: Parents' Room Core
  description: Interface between Parents' Room devices and Home Assistant via ESPHome
    and M5Stack Fire
  use_blueprint:
    path: danleongjy/room_core.yaml
    input:
      core_room: parents_room
      sleep_hours_start: input_datetime.sleep_hours_start
      sleep_hours_end: input_datetime.sleep_hours_end
      cover: cover.master_bathroom_blind
- id: '1702652446399'
  alias: Kitchen Voice Assistant Listening for Wake Word
  description: Turn on wake word listening on Kitchen Voice Assistant when presence
    detected in kitchen
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kitchen_radar_occupancy
  - platform: state
    entity_id:
    - input_boolean.away_mode
  condition: []
  action:
  - if:
    - condition: state
      entity_id: binary_sensor.kitchen_radar_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.away_mode
      state: 'off'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id:
        - switch.kitchen_core_use_wake_word
    else:
    - service: switch.turn_off
      data: {}
      target:
        entity_id:
        - switch.kitchen_core_use_wake_word
  mode: single
  max_exceeded: silent
- id: '1702898924227'
  alias: Elena's Room Core
  description: Interface between Elena's Room devices and Home Assistant via ESPHome
    and M5Stack Fire
  use_blueprint:
    path: danleongjy/room_core.yaml
    input:
      core_room: elenas_room
      sleep_hours_start: input_datetime.sleep_hours_start
      sleep_hours_end: input_datetime.sleep_hours_end
      cover: cover.elenas_room_curtains
- id: '1704838438827'
  alias: Elena's Alarm
  description: Wake up Elena at her next alarm
  triggers:
  - at: input_datetime.elenas_next_alarm
    trigger: time
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.elenas_room_next_alarm_armed
      state: 'on'
    then:
    - data:
        bedroom: elenas_room
        ringtone: La Bamba
      action: script.alarm_lights
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.elenas_room_next_alarm_armed
    data: {}
  mode: single
- id: '1704932786787'
  alias: System Startup
  description: Run setup actions 5min after startup
  trigger:
  - platform: homeassistant
    event: start
  condition: []
  action:
  - delay: 10
  - data: {}
    action: shell_command.sshsetup
  - data:
      entity_id: camera.recent_main_door_snapshot_1
      file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list') |   sort)[-1][7:]
        }}
    action: local_file.update_file_path
  - data:
      entity_id: camera.recent_main_door_snapshot_2
      file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list') |   sort)[-2][7:]
        }}
    action: local_file.update_file_path
  - data:
      entity_id: camera.recent_main_door_snapshot_3
      file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list') |   sort)[-3][7:]
        }}
    action: local_file.update_file_path
  mode: single
- id: '1705228748219'
  alias: Notify 15min Before Wind Down
  description: Play a TTS notification 15min before wind down
  triggers:
  - alias: 15min before wind down
    value_template: '{{ now() >= today_at(states(''input_datetime.wind_down'')) -
      timedelta(minutes = 15) }}'
    trigger: template
  conditions:
  - condition: state
    entity_id: input_boolean.party_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.away_mode
    state: 'off'
  actions:
  - parallel:
    - if:
      - condition: state
        entity_id: binary_sensor.study_room_ethernet_connection
        state: 'off'
      then:
      - action: media_player.play_media
        metadata: {}
        target:
          entity_id: media_player.study_room_speaker
        data:
          media:
            media_content_id: media-source://media_source/local/winding_down.wav
            media_content_type: audio/x-wav
            metadata:
              title: winding_down.wav
              thumbnail:
              media_class: music
              children_media_class:
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              browse_entity_id: media_player.study_room_speaker
          announce: true
    - action: media_player.play_media
      metadata: {}
      data:
        media:
          media_content_id: media-source://media_source/local/winding_down.wav
          media_content_type: audio/x-wav
          metadata:
            title: winding_down.wav
            thumbnail:
            media_class: music
            children_media_class:
            navigateIds:
            - {}
            - media_content_type: app
              media_content_id: media-source://media_source
            browse_entity_id: media_player.study_room_speaker
        announce: true
      target:
        entity_id: media_player.kitchen_speaker
    - sequence:
      - action: media_player.play_media
        metadata: {}
        data:
          media:
            media_content_id: media-source://media_source/local/winding_down.wav
            media_content_type: audio/x-wav
            metadata:
              title: winding_down.wav
              thumbnail:
              media_class: music
              children_media_class:
              navigateIds:
              - {}
              - media_content_type: app
                media_content_id: media-source://media_source
              browse_entity_id: media_player.study_room_speaker
          announce: true
        target:
          entity_id: media_player.dining_room_speaker
  mode: single
- id: '1707352533395'
  alias: Notify When Server Load High
  description: Send a notification when server load has been persistently high
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.node_proxmox_cpu_used
    for:
      hours: 1
      minutes: 0
      seconds: 0
    above: 20
    id: high
  - platform: numeric_state
    entity_id:
    - sensor.node_proxmox_cpu_used
    below: 20
    id: low
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - high
    then:
    - service: notify.mobile_app_aurora
      metadata: {}
      data:
        message: CPU load exceeded 20% for at least 1h
        title: Check server
        data:
          tag: high
          clickAction: /lovelace/network
    else:
    - service: notify.mobile_app_aurora
      metadata: {}
      data:
        message: clear_notification
        data:
          tag: high
  mode: single
- id: '1708242484217'
  alias: Notify When Zigbee Devices Have Issues
  description: Send a notification listing the Zigbee devices with low batteries or
    connection issues
  trigger:
  - platform: time
    at: input_datetime.sleep_hours_end
  - platform: numeric_state
    entity_id:
    - sensor.zha_device_issues
    above: 10
  condition: []
  action:
  - service: notify.mobile_app_aurora
    metadata: {}
    data:
      message: clear_notification
      data:
        tag: batts_low
  - if:
    - condition: numeric_state
      entity_id: sensor.zha_device_issues
      above: 0
    then:
    - delay: 1
    - service: notify.mobile_app_aurora
      metadata: {}
      data:
        title: Check Zigbee Devices
        data:
          tag: batts_low
          clickAction: /lovelace/zigbee-diagnostics
        message: "{% set message = namespace(text = \"\") %} {% if state_attr('sensor.zha_device_issues','disconnected')
          | length > 0 %}\n  {% set message.text = message.text + 'Disconnected: '
          %}\n  {% for battery in state_attr('sensor.zha_device_issues','disconnected')
          %}\n    {% set message.text = message.text + device_attr(device_id(battery),'name_by_user')
          + ', ' %}\n  {% endfor %}\n  {% set message.text = message.text[:-2] %}\n{%
          endif %} {% if state_attr('sensor.zha_device_issues','batteries_low') |
          length > 0 %}\n  {% set message.text = message.text + '\\nLow Battery: '
          %}\n  {% for battery in state_attr('sensor.zha_device_issues','batteries_low')
          %}\n    {% set message.text = message.text + device_attr(device_id(battery),'name_by_user')
          + ', ' %}\n  {% endfor %}\n  {% set message.text = message.text[:-2] %}\n{%
          endif %} {{ message.text }}"
  mode: restart
- id: '1708558912067'
  alias: Daniel's Phone Sleep Mode
  description: Set screen brightness and Do Not Disturb for sleep before next alarm
  triggers:
  - alias: Before wakeup alarm
    value_template: '{{ now() >= (states(''input_datetime.daniels_next_alarm'') |
      as_datetime - timedelta(minutes = 1)).astimezone(now().tzinfo) and now() < (states(''input_datetime.daniels_next_alarm'')
      | as_datetime).astimezone(now().tzinfo) }}'
    id: before_wakeup
    trigger: template
  - alias: At sleep time
    value_template: '{{ now() >= (states(''input_datetime.daniels_next_alarm'') |
      as_datetime - timedelta(hours = states(''input_number.minimum_sleep_hours'')
      | float)).astimezone(now().tzinfo) and now() < (states(''input_datetime.daniels_next_alarm'')
      | as_datetime - timedelta(hours = states(''input_number.minimum_sleep_hours'')
      | float - 0.01)).astimezone(now().tzinfo) }}'
    id: sleep_time
    trigger: template
  - alias: 15min before sleep time
    value_template: "{{ now() >= (states('input_datetime.daniels_next_alarm') | as_datetime
      - timedelta(hours = states('input_number.minimum_sleep_hours') | float, minutes
      = 15)).astimezone(now().tzinfo) and \nnow() < (states('input_datetime.daniels_next_alarm')
      | as_datetime - timedelta(hours = states('input_number.minimum_sleep_hours')
      | float, minutes = 14)).astimezone(now().tzinfo) }}"
    id: before_sleep_time
    trigger: template
  - entity_id:
    - sensor.aurora_battery_state
    from: discharging
    to:
    - charging
    - full
    id: phone_charging
    trigger: state
  - entity_id:
    - sensor.aurora_battery_state
    from:
    - charging
    - full
    - not_charging
    to: discharging
    id: phone_discharging
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - before_sleep_time
      sequence:
      - metadata: {}
        data:
          title: Prepare for bed
          message: Bedtime starting at {{ (states('input_datetime.daniels_next_alarm')
            | as_datetime - timedelta(hours = states('input_number.minimum_sleep_hours')
            | float)).strftime('%H:%M') }}.
        action: notify.mobile_app_aurora
    - conditions:
      - condition: trigger
        id:
        - sleep_time
        - phone_charging
      sequence:
      - condition: template
        value_template: '{{ now() >= (states(''input_datetime.daniels_next_alarm'')
          | as_datetime - timedelta(hours = states(''input_number.minimum_sleep_hours'')
          | float)).astimezone(now().tzinfo) }}'
      - metadata: {}
        data:
          message: command_dnd
          data:
            command: alarms_only
        action: notify.mobile_app_aurora
      - delay: 1
      - metadata: {}
        data:
          message: command_auto_screen_brightness
          data:
            command: turn_off
        action: notify.mobile_app_aurora
      - delay: 1
      - metadata: {}
        data:
          message: command_screen_brightness_level
          data:
            command: 1
        action: notify.mobile_app_aurora
    - conditions:
      - condition: trigger
        id:
        - before_wakeup
        - phone_discharging
      sequence:
      - metadata: {}
        data:
          message: command_dnd
          data:
            command: 'off'
        action: notify.mobile_app_aurora
      - delay: 1
      - metadata: {}
        data:
          message: command_auto_screen_brightness
          data:
            command: turn_on
        action: notify.mobile_app_aurora
  mode: single
- id: '1712999157282'
  alias: Study Room Core
  description: Interface between Study Room devices and Home Assistant via ESPHome
    and M5Stack Basic
  use_blueprint:
    path: danleongjy/room_core.yaml
    input:
      core_room: study_room
      sleep_hours_start: input_datetime.sleep_hours_start
      sleep_hours_end: input_datetime.sleep_hours_end
      cover: cover.study_room_blinds
- id: '1715733470037'
  alias: Windows Set AC
  description: Set AC state when windows are opened or closed
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.parents_room_left_window
    id: parents_room
    from:
    - 'on'
    - 'off'
    to:
    - 'on'
    - 'off'
  - platform: state
    entity_id:
    - binary_sensor.elis_room_right_window
    from:
    - 'on'
    - 'off'
    to:
    - 'on'
    - 'off'
    id: elis_room
  - platform: state
    entity_id:
    - binary_sensor.elenas_room_left_window
    from:
    - 'on'
    - 'off'
    to:
    - 'on'
    - 'off'
    id: elenas_room
  condition: []
  action:
  - service: automation.trigger
    target:
      entity_id: automation.{{ trigger.id }}_motion_ac
    data:
      skip_condition: true
  mode: single
- id: '1722233345556'
  alias: Kitchen Core
  description: Interface between Kitchen devices and Home Assistant via ESPHome and
    M5StickC Plus
  triggers:
  - entity_id:
    - sensor.kitchen_core_current_command
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.kitchen_core_current_command'') in [''lights_on'',''lights_off'',''lights_brighten'',''lights_darken'',''lights_auto_control'',''lights_manual_control'']
          }}'
      sequence:
      - action: script.lights_controller
        data:
          lights:
          - light.kitchen_lights
          command: '{{ states(''sensor.kitchen_core_current_command'') }}'
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.kitchen_core_current_command'') in [''cover_open'',''cover_close'',''cover_auto_control'',''cover_manual_control'']
          }}'
      sequence:
      - action: script.cover_controller
        metadata: {}
        data:
          cover: cover.kitchen_blind
          command: '{{ states(''sensor.kitchen_core_current_command'') }}'
  mode: single
- id: '1722382955872'
  alias: Study Room Voice Assistant Listening for Wake Word
  description: Turn on wake word listening on Study Room Voice Assistant when presence
    detected in Study Room and nothing is connected to Ethernet
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.study_room_ethernet_connection
    - binary_sensor.study_room_motion
  condition: []
  action:
  - if:
    - condition: state
      entity_id: binary_sensor.study_room_ethernet_connection
      state: 'off'
    - condition: state
      entity_id: binary_sensor.study_room_motion
      state: 'on'
    then:
    - service: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: switch.study_room_voice_assistant_use_wake_word
    else:
    - service: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.study_room_voice_assistant_use_wake_word
  mode: single
- id: '1724106276332'
  alias: Main Door Camera
  description: Take a snapshot and animate camera hex light
  triggers:
  - entity_id:
    - binary_sensor.doorbell_motion
    from:
    - 'off'
    to:
    - 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
    trigger: state
    id: snapshot
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_motion
    from: 'off'
    to: 'on'
    id: motion
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_motion
    from: 'on'
    to: 'off'
    id: no_motion
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.main_door
    from: 'off'
    to: 'on'
    id: door_opened
  - trigger: state
    entity_id:
    - binary_sensor.main_door
    from: 'on'
    to: 'off'
    id: door_closed
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_button
    from: 'off'
    to: 'on'
    id: doorbell
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - snapshot
      sequence:
      - metadata: {}
        data:
          value: snapshot_{{ now().strftime('%Y%m%d_%H%M%S') }}.png
        target:
          entity_id: input_text.newest_main_door_camera_snapshot_filename
        action: input_text.set_value
      - metadata: {}
        data:
          filename: /media/main_door_camera/{{ states('input_text.newest_main_door_camera_snapshot_filename')
            }}
        target:
          entity_id: camera.main_door_camera
        action: camera.snapshot
      - wait_for_trigger:
        - entity_id:
          - sensor.main_door_camera
          trigger: state
        continue_on_timeout: false
        timeout: 60
      - data:
          entity_id: camera.recent_main_door_snapshot_1
          file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list')
            |   sort)[-1][7:] }}
        action: local_file.update_file_path
      - data:
          entity_id: camera.recent_main_door_snapshot_2
          file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list')
            |   sort)[-2][7:] }}
        action: local_file.update_file_path
      - data:
          entity_id: camera.recent_main_door_snapshot_3
          file_path: /media/{{ (state_attr('sensor.main_door_camera', 'file_list')
            |   sort)[-3][7:] }}
        action: local_file.update_file_path
    - conditions:
      - condition: trigger
        id:
        - motion
      sequence:
      - condition: state
        entity_id: binary_sensor.main_door
        state: 'off'
      - action: light.turn_on
        metadata: {}
        data:
          effect: Pulse
        target:
          entity_id: light.main_door_camera_led
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 50
          effect: Right Arrow
        target:
          entity_id: light.doorbell_hex_light
    - conditions:
      - condition: trigger
        id:
        - doorbell
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          effect: Wait
          brightness_pct: 50
        target:
          entity_id: light.doorbell_hex_light
    - conditions:
      - condition: trigger
        id:
        - door_opened
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          effect: Heart
          brightness_pct: 50
        target:
          entity_id: light.doorbell_hex_light
    default:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.main_door_camera_led
        - light.doorbell_hex_light
  mode: parallel
  max: 10
- id: '1731678711205'
  alias: Elena's Room Curtains Auto Control
  description: Open or close Elena's Room Curtains based on time and windows state
  use_blueprint:
    path: danleongjy/bedroom_curtains_auto_control.yaml
    input:
      curtains: cover.elenas_room_curtains
      windows: binary_sensor.elenas_room_left_window
      doors: binary_sensor.elenas_room_door
      motion: binary_sensor.elenas_room_presence
- id: '1731678994131'
  alias: Eli's Room Curtains Auto Control
  description: Open or close Eli's Room Curtains based on time and windows state
  use_blueprint:
    path: danleongjy/bedroom_curtains_auto_control.yaml
    input:
      curtains: cover.elis_room_curtains
      windows: binary_sensor.elis_room_right_window
      doors: binary_sensor.elis_room_door
      motion: binary_sensor.elis_room_presence
- id: '1735294884034'
  alias: Daniel's Next Alarm
  description: Set the date and time for Daniel's next alarm
  triggers:
  - alias: When Daniel's Next Alarm has fired
    value_template: '{{ now() > as_datetime(states(''input_datetime.daniels_next_alarm'')).astimezone(now().tzinfo)
      + timedelta(minutes = 6) }}'
    id: alarm_fired
    trigger: template
  - entity_id:
    - calendar.daniel_work_days
    - calendar.elena_school_days
    - calendar.eli_school_days
    id: calendar_changed
    trigger: state
  - entity_id:
    - input_datetime.eca_day_alarm
    - input_datetime.elenas_school_day_alarm
    - input_datetime.elis_school_day_alarm
    - input_datetime.daniels_work_day_alarm
    id: childrens_alarms_changed
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - alarm_fired
    then:
    - data:
        start_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
          = 9, minute = 30) }}'
        end_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
          = 12, minute = 0) }}'
      target:
        entity_id: calendar.daniel_work_days
      response_variable: work_days
      alias: List Daniel's morning work days occurring on Daniel's Next Alarm
      action: calendar.get_events
    - data:
        start_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
          = 0, minute = 0) }}'
        end_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
          = 0, minute = 0) + timedelta(days = 1) }}'
      target:
        entity_id:
        - calendar.eli_school_days
        - calendar.elena_school_days
      response_variable: school_days
      alias: List school days occurring on Daniel's Next Alarm
      action: calendar.get_events
    - repeat:
        until:
        - condition: template
          value_template: '{{ now().date() < as_datetime(states(''input_datetime.daniels_next_alarm'')).date()
            }}'
          alias: Alarm day is in the future
        - or:
          - condition: template
            value_template: '{{ work_days[''calendar.daniel_work_days''].events |
              length > 0 }}'
            alias: Daniel has a work day
          - condition: template
            value_template: "{% set output = false %} {% if school_days['calendar.eli_school_days'].events
              | length > 0 %}\n  {% if as_datetime(school_days['calendar.eli_school_days'].events[0].start).weekday()
              in [1,2,3,5] %}\n    {% set output = true %}\n  {% endif %}\n{% endif
              %} {{ output }}"
            alias: Eli has a school day and it is on Tue, Wed, Thu or Sat
          - condition: template
            value_template: "{% set output = false %} {% if school_days['calendar.elena_school_days'].events
              | length > 0 %}\n  {% if as_datetime(school_days['calendar.elena_school_days'].events[0].start).weekday()
              in [0,4] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %}
              {{ output }}"
            alias: Elena has a school day and it is on Mon or Fri
        sequence:
        - data:
            date: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).date()
              + timedelta(days = 1) }}'
          target:
            entity_id: input_datetime.daniels_next_alarm
          alias: Increment alarm by 1 day
          action: input_datetime.set_datetime
        - data:
            start_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
              = 9, minute = 30) }}'
            end_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
              = 12, minute = 0) }}'
          target:
            entity_id: calendar.daniel_work_days
          response_variable: work_days
          alias: List Daniel's morning work days occurring on Daniel's Next Alarm
          action: calendar.get_events
        - data:
            start_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
              = 0, minute = 0) }}'
            end_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
              = 0, minute = 0) + timedelta(days = 1) }}'
          target:
            entity_id:
            - calendar.eli_school_days
            - calendar.elena_school_days
          response_variable: school_days
          alias: List school days occurring on Daniel's Next Alarm
          action: calendar.get_events
  - data:
      start_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
        = 0, minute = 0) }}'
      end_date_time: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).replace(hour
        = 0, minute = 0) + timedelta(days = 1) }}'
    target:
      entity_id:
      - calendar.eli_school_days
      - calendar.elena_school_days
    response_variable: school_days
    alias: List school days occurring on Daniel's Next Alarm
    action: calendar.get_events
  - choose:
    - conditions:
      - alias: If Elena has school on Tue, Wed or Fri
        condition: template
        value_template: "{% set output = false %}\n{% if school_days['calendar.elena_school_days'].events
          | length > 0 %}\n  {% if as_datetime(school_days['calendar.elena_school_days'].events[0].start).weekday()
          in [1,2,4] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %}\n{{
          output }}"
      sequence:
      - data:
          time: '{{ states(''input_datetime.elenas_school_day_alarm'') }}'
        target:
          entity_id: input_datetime.daniels_next_alarm
        alias: Set Daniel's Next Alarm to Elena's School Day Alarm
        action: input_datetime.set_datetime
      - alias: Set Daniel's Next Alarm 5min before Elena's alarm
        data:
          datetime: '{{ as_datetime(states(''input_datetime.daniels_next_alarm''))
            - timedelta(minutes = 5) }}'
        target:
          entity_id: input_datetime.daniels_next_alarm
        action: input_datetime.set_datetime
    - conditions:
      - alias: If Eli has school on Mon, Thu or Sat
        condition: template
        value_template: "{% set output = false %} \n{% if school_days['calendar.eli_school_days'].events
          | length > 0 %}\n  {% if as_datetime(school_days['calendar.eli_school_days'].events[0].start).weekday()
          in [0,3,5] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %} \n{{
          output }}"
      sequence:
      - if:
        - condition: template
          value_template: '{{ as_datetime(states(''input_datetime.daniels_next_alarm'')).weekday()
            < 5 }}'
          alias: Alarm is on a weekday
        then:
        - data:
            time: '{{ states(''input_datetime.elis_school_day_alarm'') }}'
          target:
            entity_id: input_datetime.daniels_next_alarm
          alias: Set Daniel's Next Alarm to Eli's School Day Alarm
          action: input_datetime.set_datetime
        - alias: Set Daniel's Next Alarm 15min before Eli's alarm
          data:
            datetime: '{{ as_datetime(states(''input_datetime.daniels_next_alarm''))
              - timedelta(minutes = 15) }}'
          target:
            entity_id: input_datetime.daniels_next_alarm
          action: input_datetime.set_datetime
        else:
        - data:
            time: '{{ states(''input_datetime.eca_day_alarm'') }}'
          target:
            entity_id: input_datetime.daniels_next_alarm
          alias: Set Daniel's Next Alarm to ECA Day Alarm
          action: input_datetime.set_datetime
        - data:
            datetime: '{{ as_datetime(states(''input_datetime.daniels_next_alarm''))
              - timedelta(minutes = 10) }}'
          target:
            entity_id: input_datetime.daniels_next_alarm
          alias: Set Daniel's Next Alarm 10min before kids' alarm
          action: input_datetime.set_datetime
    default:
    - data:
        time: '{{ states(''input_datetime.daniels_work_day_alarm'') }}'
      target:
        entity_id: input_datetime.daniels_next_alarm
      alias: Set Daniel's Next Alarm to Daniel's Work Day Alarm
      action: input_datetime.set_datetime
  mode: single
  max_exceeded: silent
- id: '1735296274500'
  alias: Grace's Next Alarm
  description: Set the date and time for Grace's next alarm
  triggers:
  - alias: When Grace's Next Alarm has fired
    value_template: '{{ now() > as_datetime(states(''input_datetime.graces_next_alarm'')).astimezone(now().tzinfo)
      + timedelta(minutes = 6) }}'
    id: alarm_fired
    trigger: template
  - entity_id:
    - calendar.grace_work_days
    - calendar.elena_school_days
    - calendar.eli_school_days
    id: calendar_changed
    trigger: state
  - entity_id:
    - input_datetime.eca_day_alarm
    - input_datetime.elenas_school_day_alarm
    - input_datetime.elis_school_day_alarm
    - input_datetime.graces_work_day_alarm
    id: childrens_alarms_changed
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - alarm_fired
    then:
    - data:
        start_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
          = 9, minute = 30) }}'
        end_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
          = 12, minute = 0) }}'
      target:
        entity_id: calendar.grace_work_days
      response_variable: work_days
      alias: List Grace's morning work days occurring on Grace's Next Alarm
      action: calendar.get_events
    - data:
        start_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
          = 0, minute = 0) }}'
        end_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
          = 0, minute = 0) + timedelta(days = 1) }}'
      target:
        entity_id:
        - calendar.eli_school_days
        - calendar.elena_school_days
      response_variable: school_days
      alias: List school days occurring on Grace's Next Alarm
      action: calendar.get_events
    - repeat:
        until:
        - alias: Alarm day is in the future
          condition: template
          value_template: '{{ now().date() < as_datetime(states(''input_datetime.graces_next_alarm'')).date()
            }}'
        - condition: or
          conditions:
          - alias: Grace has a work day
            condition: template
            value_template: '{{ work_days[''calendar.grace_work_days''].events | length
              > 0 }}'
          - alias: Eli has a school day and it is on Mon or Fri
            condition: template
            value_template: "{% set output = false %} {% if school_days['calendar.eli_school_days'].events
              | length > 0 %}\n  {% if as_datetime(school_days['calendar.eli_school_days'].events[0].start).weekday()
              in [0,4] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %}
              {{ output }}"
          - alias: Elena has a school day and it is on Tue, Wed, Thu or Sat
            condition: template
            value_template: "{% set output = false %} {% if school_days['calendar.elena_school_days'].events
              | length > 0 %}\n  {% if as_datetime(school_days['calendar.elena_school_days'].events[0].start).weekday()
              in [1,2,3,5] %}\n    {% set output = true %}\n  {% endif %}\n{% endif
              %} {{ output }}"
        sequence:
        - data:
            date: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).date()
              + timedelta(days = 1) }}'
          target:
            entity_id: input_datetime.graces_next_alarm
          alias: Increment alarm by 1 day
          action: input_datetime.set_datetime
        - data:
            start_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
              = 9, minute = 30) }}'
            end_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
              = 12, minute = 0) }}'
          target:
            entity_id: calendar.grace_work_days
          response_variable: work_days
          alias: List Grace's morning work days occurring on Grace's Next Alarm
          action: calendar.get_events
        - data:
            start_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
              = 0, minute = 0) }}'
            end_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
              = 0, minute = 0) + timedelta(days = 1) }}'
          target:
            entity_id:
            - calendar.eli_school_days
            - calendar.elena_school_days
          response_variable: school_days
          alias: List school days occurring on Grace's Next Alarm
          action: calendar.get_events
  - data:
      start_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
        = 0, minute = 0) }}'
      end_date_time: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).replace(hour
        = 0, minute = 0) + timedelta(days = 1) }}'
    target:
      entity_id:
      - calendar.eli_school_days
      - calendar.elena_school_days
    response_variable: school_days
    alias: List school days occurring on Grace's Next Alarm
    action: calendar.get_events
  - choose:
    - conditions:
      - alias: If Elena has school on Mon, Thu or Sat
        condition: template
        value_template: "{% set output = false %}\n{% if school_days['calendar.elena_school_days'].events
          | length > 0 %}\n  {% if as_datetime(school_days['calendar.elena_school_days'].events[0].start).weekday()
          in [0,3,5] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %}\n{{
          output }}"
      sequence:
      - if:
        - alias: Alarm is on a weekday
          condition: template
          value_template: '{{ as_datetime(states(''input_datetime.graces_next_alarm'')).weekday()
            < 5 }}'
        then:
        - data:
            time: '{{ states(''input_datetime.elenas_school_day_alarm'') }}'
          target:
            entity_id: input_datetime.graces_next_alarm
          alias: Set Grace's Next Alarm to Elena's School Day Alarm
          action: input_datetime.set_datetime
        - data:
            datetime: '{{ as_datetime(states(''input_datetime.graces_next_alarm''))
              - timedelta(minutes = 5) }}'
          target:
            entity_id: input_datetime.graces_next_alarm
          alias: Set Grace's Next Alarm 5min before Elena's alarm
          action: input_datetime.set_datetime
        else:
        - data:
            time: '{{ states(''input_datetime.eca_day_alarm'') }}'
          target:
            entity_id: input_datetime.graces_next_alarm
          alias: Set Grace's Next Alarm to ECA Day Alarm
          action: input_datetime.set_datetime
        - data:
            datetime: '{{ as_datetime(states(''input_datetime.graces_next_alarm''))
              - timedelta(minutes = 10) }}'
          target:
            entity_id: input_datetime.graces_next_alarm
          alias: Set Grace's Next Alarm 10min before kids' alarm
          action: input_datetime.set_datetime
    - conditions:
      - alias: If Eli has school on Tue, Wed or Fri
        condition: template
        value_template: "{% set output = false %} \n{% if school_days['calendar.eli_school_days'].events
          | length > 0 %}\n  {% if as_datetime(school_days['calendar.eli_school_days'].events[0].start).weekday()
          in [1,2,4] %}\n    {% set output = true %}\n  {% endif %}\n{% endif %} \n{{
          output }}"
      sequence:
      - data:
          time: '{{ states(''input_datetime.elis_school_day_alarm'') }}'
        target:
          entity_id: input_datetime.graces_next_alarm
        alias: Set Grace's Next Alarm to Eli's School Day Alarm
        action: input_datetime.set_datetime
      - data:
          datetime: '{{ as_datetime(states(''input_datetime.graces_next_alarm''))
            - timedelta(minutes = 10) }}'
        target:
          entity_id: input_datetime.graces_next_alarm
        alias: Set Grace's Next Alarm 10min before Eli's alarm
        action: input_datetime.set_datetime
    default:
    - data:
        time: '{{ states(''input_datetime.graces_work_day_alarm'') }}'
      target:
        entity_id: input_datetime.graces_next_alarm
      alias: Set Grace's Next Alarm to Grace's Work Day Alarm
      action: input_datetime.set_datetime
  mode: single
  max_exceeded: silent
- id: '1735634631542'
  alias: Elena's Room Controller
  description: Control Elena's Room Lights, Fan, AC and Curtain
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: bcfa3b3429c3ad745cc8299a3d74e3d3
      helper_last_controller_event: input_text.zz_elena_s_room_controller_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id: light.elenas_room_lights
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elenas_room_lights
            - light.elenas_room_bedside_lamp
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elenas_room_lights
            - light.elenas_room_bedside_lamp
            command: lights_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: light.elenas_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.elenas_room_lights
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.elenas_room_lights
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
      action_button_down_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.elenas_room_curtains
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elenas_room_curtains
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.elenas_room_curtains
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elenas_room_curtains
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.elenas_room_curtains
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elenas_room_curtains
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elenas_room_curtains
              command: cover_open
      action_button_down_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.elenas_room_curtains'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.elenas_room_curtains
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.elenas_room_curtains
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.elenas_room_curtains
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.elenas_room_curtains
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_left_short:
      - if:
        - condition: state
          entity_id: fan.elenas_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_off
      action_button_left_long:
      - if:
        - condition: numeric_state
          entity_id: fan.elenas_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.elenas_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.elenas_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
      action_button_right_short:
      - if:
        - condition: state
          entity_id: climate.elenas_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elenas_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elenas_room_ac
            command: ac_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: climate.elenas_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.elenas_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.elenas_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_elena_s_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_up_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.elenas_room_lights
          command: set_recommended_room_scene
      action_button_down_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.elenas_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_left_double:
      - if:
        - condition: state
          entity_id: fan.elenas_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_forward
      action_button_right_double:
      - if:
        - condition: state
          entity_id:
          - automation.elenas_room_fan_auto_control
          - automation.elenas_room_curtains_auto_control
          - automation.elenas_room_motion_ac
          - automation.elenas_room_motion_lights
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elenas_room_lights
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elenas_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.elenas_room_curtains
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elenas_room_lights
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elenas_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elenas_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.elenas_room_curtains
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_down_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.elenas_room_curtains
- id: '1736504317285'
  alias: Elena's Room Motion Bedside Lamp
  description: Set Elena's Room Bedside Lamp when motion is detected, the door is
    open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.elenas_room_bedside_lamp
      motion_sensor: binary_sensor.elenas_room_presence
      lux_sensor: sensor.elenas_room_lux
      entities_list:
      - light.elenas_room_lights
      - fan.elenas_room_fan
      - climate.elenas_room_ac
      - light.elenas_room_bedside_lamp
      doors_list:
      - binary_sensor.elenas_room_door
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1736671451711'
  alias: Study Room Motion Floor Lamp
  description: Turn on the Study Room Floor Lamp if any lights are on in Living Room
    or Study Room
  triggers:
  - trigger: state
    entity_id:
    - light.living_room_lights
    - light.living_room_pendant_light_entity
    - light.study_room_lights
    to:
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id:
      - light.living_room_lights
      - light.living_room_pendant_light_entity
      - light.study_room_lights
      state: 'off'
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: light.study_room_floor_lamp
    else:
    - action: light.turn_on
      metadata: {}
      data:
        brightness_pct: "{{ 66 if (now() >= today_at(states('input_datetime.dim_hours_start'))
          or\n          now() <= today_at(states('input_datetime.dim_hours_end')))
          and\n      is_state('input_boolean.party_mode','off') else 100 }}"
      target:
        entity_id: light.study_room_floor_lamp
  mode: restart
- id: '1737111238720'
  alias: Eli's Room Motion Floor Lamp
  description: Set Eli's Room Floor Lamp when motion is detected, at least one door
    is open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.elis_room_floor_lamp
      motion_sensor: binary_sensor.elis_room_presence
      lux_sensor: sensor.elis_room_lux
      entities_list:
      - light.elis_room_lights
      - fan.elis_room_fan
      - climate.elis_room_ac
      doors_list:
      - binary_sensor.elis_room_door
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1737250321335'
  alias: Eli's Room Controller
  description: Control Eli's Room Lights, Fan, AC and Curtain
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: 2a79eee803f9810b4a7a0e1cb35eab9a
      helper_last_controller_event: input_text.zz_eli_s_room_controller_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id:
          - light.elis_room_lights
          - light.elis_room_floor_lamp
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elis_room_lights
            - light.elis_room_floor_lamp
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elis_room_lights
            - light.elis_room_floor_lamp
            command: lights_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: light.elis_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.elis_room_lights
                - light.elis_room_floor_lamp
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.elis_room_lights
                - light.elis_room_floor_lamp
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
      action_button_down_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.elis_room_curtains
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elis_room_curtains
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.elis_room_curtains
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elis_room_curtains
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.elis_room_curtains
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elis_room_curtains
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.elis_room_curtains
              command: cover_open
      action_button_down_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.elis_room_curtains'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.elis_room_curtains
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.elis_room_curtains
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.elis_room_curtains
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.elis_room_curtains
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_left_short:
      - if:
        - condition: state
          entity_id: fan.elis_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_off
      action_button_left_long:
      - if:
        - condition: numeric_state
          entity_id: fan.elis_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.elis_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.elis_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
      action_button_right_short:
      - if:
        - condition: state
          entity_id: climate.elis_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elis_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elis_room_ac
            command: ac_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: climate.elis_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.elis_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.elis_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_eli_s_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_up_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.elis_room_lights
          command: set_recommended_room_scene
      action_button_down_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.elis_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_left_double:
      - if:
        - condition: state
          entity_id: fan.elis_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_forward
      action_button_right_double:
      - if:
        - condition: state
          entity_id:
          - automation.elis_room_fan_auto_control
          - automation.elis_room_curtains_auto_control
          - automation.elis_room_motion_ac
          - automation.elis_room_motion_lights
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elis_room_lights
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elis_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.elis_room_curtains
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.elis_room_lights
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.elis_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.elis_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.elis_room_curtains
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_down_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.elis_room_curtains
- id: '1737252290821'
  alias: Parents' Room Controller
  description: Control Parents' Room Lights, Fan, AC and Curtain
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: da66c1fba540bf50cae3fef8482f8f77
      helper_last_controller_event: input_text.zz_parents_room_controller_last_event
      action_button_right_short:
      - if:
        - condition: state
          entity_id:
          - light.parents_room_lights
          - light.parents_room_bedside_lamp
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.parents_room_lights
            - light.parents_room_bedside_lamp
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.parents_room_lights
            - light.parents_room_bedside_lamp
            command: lights_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: light.parents_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.parents_room_lights
                - light.parents_room_bedside_lamp
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.parents_room_lights
                - light.parents_room_bedside_lamp
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
      action_button_left_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.master_bathroom_blind
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.master_bathroom_blind
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.master_bathroom_blind
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.master_bathroom_blind
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.master_bathroom_blind
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.master_bathroom_blind
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.master_bathroom_blind
              command: cover_open
        enabled: true
      action_button_left_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.master_bathroom_blind'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.master_bathroom_blind
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.master_bathroom_blind
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.master_bathroom_blind
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.master_bathroom_blind
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_up_short:
      - if:
        - condition: state
          entity_id: fan.parents_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: fan.parents_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.parents_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.parents_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
      action_button_down_short:
      - if:
        - condition: state
          entity_id: climate.parents_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.parents_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.parents_room_ac
            command: ac_off
      action_button_down_long:
      - if:
        - condition: numeric_state
          entity_id: climate.parents_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.parents_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.parents_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_parents_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_right_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.parents_room_lights
          command: set_recommended_room_scene
      action_button_left_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.parents_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_up_double:
      - if:
        - condition: state
          entity_id: fan.parents_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_forward
      action_button_down_double:
      - if:
        - condition: state
          entity_id:
          - automation.parents_room_fan_auto_control
          - automation.master_bathroom_blind_auto_control
          - automation.parents_room_motion_ac
          - automation.parents_room_motion_lights
          - automation.parents_room_motion_bedside_lamp
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.parents_room_core_led_strips
            - light.parents_room_lights
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.parents_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.master_bathroom_blind
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.parents_room_core_led_strips
            - light.parents_room_lights
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.parents_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.parents_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.master_bathroom_blind
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_left_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.master_bathroom_blind
- id: '1739698582718'
  alias: Doorbell
  description: Play doorbell tones, flash Room Core lights and show Camera view on
    Main Door Display when Main Door Camera Button is pressed
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_button
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - variables:
      rooms:
        elis_room:
          door: binary_sensor.elis_room_door
          button: button.elis_room_core_ring_doorbell
        elenas_room:
          door: binary_sensor.elenas_room_door
          button: button.elenas_room_core_ring_doorbell
        parents_room:
          door: binary_sensor.parents_room_doors
          button: button.parents_room_core_ring_doorbell
      doorbell_track: "{{ ['JR DDG Final Osaka Loop', \n                                                               'JR
        DDG nDS e231 Door Chime',\n                                                               'JR
        Station Notification 2',\n                                                               'JR
        Sunny Spot V1',\n                                                               'JR
        Cosmos V1',\n                                                               'JR
        Susuki Heights V2'] | random }}.mp3\n"
  - parallel:
    - sequence:
      - delay: 1
      - target:
          entity_id: media_player.main_door_display
        data:
          media:
            media_content_id: media-source://media_source/local/doorbells/{{ doorbell_track
              }}
            media_content_type: music
            announce: true
        action: media_player.play_media
      - target:
          entity_id: media_player.kitchen_speaker
        data:
          media:
            media_content_id: media-source://media_source/local/doorbells/{{ doorbell_track
              }}
            media_content_type: music
          announce: true
        action: media_player.play_media
    - sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
      - metadata: {}
        data:
          message: Doorbell rung at {{ now().strftime('%H:%M') }}.
          title: Please Check the Door
          data:
            image: /media/local/main_door_camera/{{ states('input_text.newest_main_door_camera_snapshot_filename')
              }}
            clickAction: /lovelace/main-door
        action: notify.mobile_app_aurora
    - sequence:
      - repeat:
          for_each:
          - elis_room
          - elenas_room
          - parents_room
          sequence:
            if:
            - condition: template
              value_template: '{{ is_state(rooms[repeat.item][''door''], ''on'') }}'
            then:
            - target:
                entity_id: '{{ rooms[repeat.item][''button''] }}'
              action: button.press
      - data: {}
        action: button.press
        target:
          entity_id:
          - button.kitchen_core_ring_doorbell
          - button.study_room_core_ring_doorbell
    - sequence:
      - condition: state
        entity_id: binary_sensor.study_room_ethernet_connection
        state: 'off'
      - delay: 1
      - target:
          entity_id: media_player.study_room_speaker
        data:
          announce: true
          media:
            media_content_id: media-source://media_source/local/doorbells/{{ doorbell_track
              }}
            media_content_type: music
            metadata: {}
        action: media_player.play_media
  mode: single
- id: '1742085553481'
  alias: Study Room Controller
  description: Control Study Room Lights, Fan, AC and Blinds
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: 26bde7f23fb321ec14c0d72d85803c5a
      helper_last_controller_event: input_text.zz_study_room_controller_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id:
          - light.study_room_lights
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.study_room_lights
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.study_room_lights
            command: lights_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: light.study_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.study_room_lights
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.study_room_lights
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
      action_button_down_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.study_room_blinds
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.study_room_blinds
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.study_room_blinds
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.study_room_blinds
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.study_room_blinds
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.study_room_blinds
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.study_room_blinds
              command: cover_open
      action_button_down_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.study_room_blinds'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.study_room_blinds
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.study_room_blinds
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.study_room_blinds
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.study_room_blinds
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_left_short:
      - if:
        - condition: state
          entity_id: fan.study_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_off
      action_button_left_long:
      - if:
        - condition: numeric_state
          entity_id: fan.study_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.study_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.study_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
      action_button_right_short:
      - if:
        - condition: state
          entity_id: climate.study_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.study_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.study_room_ac
            command: ac_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: climate.study_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.study_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.study_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_study_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_up_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.study_room_lights
          command: set_recommended_room_scene
      action_button_down_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.study_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_left_double:
      - if:
        - condition: state
          entity_id: fan.study_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_forward
      action_button_right_double:
      - if:
        - condition: state
          entity_id:
          - automation.study_room_fan_auto_control
          - automation.south_facing_blinds_auto_control
          - automation.study_room_motion_ac
          - automation.study_room_motion_lights
          - automation.study_room_motion_floor_lamp
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.study_room_lights
            - light.study_room_floor_lamp
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.study_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.study_room_blinds
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.study_room_lights
            - light.study_room_floor_lamp
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.study_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.study_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.study_room_blinds
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_down_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.study_room_blinds
- id: '1742086082863'
  alias: Living Room Controller
  description: Control Living Room Lights, Fan, AC and Blinds
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: cdb28d90dff65019c51c86a594ca51ca
      helper_last_controller_event: input_text.zz_living_room_controller_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id:
          - light.living_room_lights
          - light.living_room_pendant_light_entity
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.living_room_lights
            - light.living_room_pendant_light_entity
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.living_room_lights
            - light.living_room_pendant_light_entity
            command: lights_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: light.living_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.living_room_lights
                - light.living_room_pendant_light_entity
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.living_room_lights
                - light.living_room_pendant_light_entity
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
      action_button_down_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.living_room_blinds
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.living_room_blinds
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.living_room_blinds
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.living_room_blinds
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.living_room_blinds
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.living_room_blinds
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.living_room_blinds
              command: cover_open
      action_button_down_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.living_room_blinds'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.living_room_blinds
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.living_room_blinds
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.living_room_blinds
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.living_room_blinds
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_left_short:
      - if:
        - condition: state
          entity_id: fan.living_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_off
      action_button_left_long:
      - if:
        - condition: numeric_state
          entity_id: fan.living_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.living_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.living_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
      action_button_right_short:
      - if:
        - condition: state
          entity_id: climate.living_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.living_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.living_room_ac
            command: ac_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: climate.living_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.living_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.living_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_living_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_up_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.living_room_lights
          command: set_recommended_room_scene
      action_button_down_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.living_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_left_double:
      - if:
        - condition: state
          entity_id: fan.living_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_forward
      action_button_right_double:
      - if:
        - condition: state
          entity_id:
          - automation.living_room_fan_auto_control
          - automation.south_facing_blinds_auto_control
          - automation.living_room_motion_ac
          - automation.living_room_motion_lights
          - automation.living_room_motion_pendant_light
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.living_room_lights
            - light.living_room_pendant_light_entity
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.living_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.living_room_blinds
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.living_room_lights
            - light.living_room_pendant_light_entity
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.living_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.living_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.living_room_blinds
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_down_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.living_room_blinds
- id: '1742086500434'
  alias: Dining Room Controller
  description: Control Dining Room Lights, Fan, AC and Blinds
  use_blueprint:
    path: EPMatt/ikea_e2001_e2002.yaml
    input:
      integration: ZHA
      controller_device: 56e2c86f28cde4b93dc27172af9c198a
      helper_last_controller_event: input_text.zz_dining_room_controller_last_event
      action_button_up_short:
      - if:
        - condition: state
          entity_id:
          - light.dining_room_lights
          - light.dining_room_pendant_light_entity
          state: 'off'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.dining_room_lights
            - light.dining_room_pendant_light_entity
            command: lights_on
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.dining_room_lights
            - light.dining_room_pendant_light_entity
            command: lights_off
      action_button_up_long:
      - if:
        - condition: numeric_state
          entity_id: light.dining_room_lights
          attribute: brightness
          above: 127
        then:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.dining_room_lights
                - light.dining_room_pendant_light_entity
                command: lights_darken
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.lights_controller
              metadata: {}
              data:
                lights:
                - light.dining_room_lights
                - light.dining_room_pendant_light_entity
                command: lights_brighten
            - delay: 1
            while:
            - condition: template
              value_template: '{{ ''move'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
      action_button_down_short:
      - choose:
        - conditions:
          - condition: state
            entity_id: cover.dining_room_blinds
            state:
            - closed
            - closing
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.dining_room_blinds
              command: cover_open
        - conditions:
          - condition: state
            entity_id: cover.dining_room_blinds
            state:
            - opening
          sequence:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.dining_room_blinds
              command: cover_close
        default:
        - if:
          - condition: numeric_state
            entity_id: cover.dining_room_blinds
            attribute: current_position
            above: 50.5
          then:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.dining_room_blinds
              command: cover_close
          else:
          - action: script.cover_controller
            metadata: {}
            data:
              cover: cover.dining_room_blinds
              command: cover_open
      action_button_down_long:
      - if:
        - condition: template
          value_template: '{{ states(''cover.dining_room_blinds'') in [''opening'',''closing'']
            }}'
        then:
        - action: cover.stop_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.dining_room_blinds
        - delay: 1
      - if:
        - condition: numeric_state
          entity_id: cover.dining_room_blinds
          attribute: current_position
          above: 50.5
        then:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.dining_room_blinds
            command: cover_close
        else:
        - action: script.cover_controller
          metadata: {}
          data:
            cover: cover.dining_room_blinds
            command: cover_open
      button_up_long_loop: false
      button_up_long_max_loop_repeats: 50
      button_down_long_loop: false
      button_down_long_max_loop_repeats: 50
      action_button_left_short:
      - if:
        - condition: state
          entity_id: fan.dining_room_fan
          state: 'off'
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_on
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_off
      action_button_left_long:
      - if:
        - condition: numeric_state
          entity_id: fan.dining_room_fan
          attribute: percentage
          above: 51
        then:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.dining_room_fan
                command: fan_slow_down
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.fan_controller
              metadata: {}
              data:
                fan: fan.dining_room_fan
                command: fan_speed_up
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
      action_button_right_short:
      - if:
        - condition: state
          entity_id: climate.dining_room_ac
          state: 'off'
        then:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.dining_room_ac
            command: ac_on
        else:
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.dining_room_ac
            command: ac_off
      action_button_right_long:
      - if:
        - condition: numeric_state
          entity_id: climate.dining_room_ac
          attribute: temperature
          above: 0
          value_template: '{{ state.attributes.temperature - ((state.attributes.max_temp
            - state.attributes.min_temp) / 2 + state.attributes.min_temp )}}'
        then:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.dining_room_ac
                command: ac_colder
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
        else:
        - repeat:
            sequence:
            - action: script.ac_controller
              metadata: {}
              data:
                ac: climate.dining_room_ac
                command: ac_warmer
            - delay: 2
            while:
            - condition: template
              value_template: '{{ ''hold'' in states(''input_text.zz_dining_room_controller_last_event'')
                }}'
      button_left_long_loop: false
      button_left_long_max_loop_repeats: 50
      button_right_long_loop: false
      button_right_long_max_loop_repeats: 50
      action_button_up_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.dining_room_lights
          command: set_recommended_room_scene
      action_button_down_double:
      - action: script.lights_controller
        metadata: {}
        data:
          lights:
          - light.dining_room_lights
          command: turn_off_room
      button_up_double_press: true
      button_down_double_press: true
      helper_double_press_delay: 700
      action_button_left_double:
      - if:
        - condition: state
          entity_id: fan.dining_room_fan
          attribute: direction
          state: forward
        then:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_reverse
        else:
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_forward
      action_button_right_double:
      - if:
        - condition: state
          entity_id:
          - automation.dining_room_fan_auto_control
          - automation.south_facing_blinds_auto_control
          - automation.dining_room_motion_ac
          - automation.dining_room_motion_lights
          - automation.dining_room_motion_pendant_light
          state: 'on'
        then:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.dining_room_lights
            - light.dining_room_pendant_light_entity
            command: lights_manual_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_manual_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.dining_room_ac
            command: cooling_manual_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_manual_control
            cover: cover.dining_room_blinds
        else:
        - action: script.lights_controller
          metadata: {}
          data:
            lights:
            - light.dining_room_lights
            - light.dining_room_pendant_light_entity
            command: lights_auto_control
        - action: script.fan_controller
          metadata: {}
          data:
            fan: fan.dining_room_fan
            command: fan_auto_control
        - action: script.ac_controller
          metadata: {}
          data:
            ac: climate.dining_room_ac
            command: cooling_auto_control
        - action: script.cover_controller
          metadata: {}
          data:
            command: cover_auto_control
            cover: cover.dining_room_blinds
      button_left_double_press: true
      button_right_double_press: true
      helper_debounce_delay: 300
      action_button_down_release:
      - action: cover.stop_cover
        metadata: {}
        data: {}
        target:
          entity_id: cover.dining_room_blinds
- id: '1743847597456'
  alias: Voice Control for Party Mode
  description: Turn on or off Party Mode with voice commands
  triggers:
  - trigger: conversation
    command:
    - (I'm | I am | We're | We are) (having | throwing) a party
    - (Turn on | Activate | Initiate) party mode
    id: 'on'
  - trigger: conversation
    command:
    - (I'm | I am | We're | We are) (finishing | finished with | ending) the party
    - (I have | I've | We have | We've) (finished | ended) the party
    - (Turn off | Deactivate) party mode
    id: 'off'
  conditions: []
  actions:
  - action: input_boolean.turn_{{ trigger.id }}
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.party_mode
  - set_conversation_response: "{% if trigger.id == 'on' %}\n  {{ ['Initiating', 'Activating']
      | random }} party mode.\n{% else %}\n  {{ ['Turning off', 'Dectivating'] | random
      }} party mode.\n{% endif %}"
  mode: single
- id: '1743848105840'
  alias: Voice Control for Away Mode
  description: Turn on Away Mode with voice commands
  triggers:
  - trigger: conversation
    command:
    - (I'm | I am | We're | We are) (leaving | going out)
    - (Turn on | Activate | Initiate) (shutdown | away mode) [sequence] [procedure]
  conditions: []
  actions:
  - set_conversation_response: '{{ [''Initiating'', ''Activating''] | random }} {{
      [''Away Mode'', ''shutdown sequence''] | random }}.'
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.away_mode
    enabled: true
  mode: single
- id: '1743848999796'
  alias: Voice Control for Vacuum
  description: Control the vacuum or request for vacuum status with voice commands
  triggers:
  - trigger: conversation
    command: '{command} [the] (vacuum | vacuuming)'
    id: execute_command
  - trigger: conversation
    command:
    - (what is | whats) the vacuum doing
    - is the vacuum (on | off | running | vacuuming | cleaning | active | paused |
      stopped | returning | docked)
    - (what is | whats) the status of the vacuum
    id: get_status
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - execute_command
    then:
    - variables:
        commands:
          Turn on: start
          Run: start
          Activate: start
          Initiate: start
          Start: start
          Pause: pause
          Stop: stop
          Turn off: stop
          Deactivate: stop
          Terminate: stop
          Dock: return_to_base
          Return: return_to_base
    - target:
        entity_id: vacuum.valetudo_hestia
      action: vacuum.{{ commands[trigger.slots.command] }}
    - set_conversation_response: "{% if commands[trigger.slots.command] == 'start'
        %}\n  {{ ['Starting','Running','Initiating','Activating'] | random }} the
        vacuum.\n{% elif commands[trigger.slots.command] == 'pause' %}\n  Vacuum paused.\n{%
        elif commands[trigger.slots.command] == 'stop' %}\n  {{ ['Stopping','Deactivating']
        | random }} the vacuum.\n{% else %}\n  Returning vacuum to dock.\n{% endif
        %}"
    else:
    - set_conversation_response: "{% set clean_time = namespace(hours = (states('sensor.valetudo_hestia_current_statistics_time')
        | float(0) // 60),\n                              minutes = (states('sensor.valetudo_hestia_current_statistics_time')
        | float(0) % 60)) %}\n{% set remaining = namespace(area = (states('sensor.valetudo_hestia_current_statistics_area')
        | float(0) / states('sensor.vacuum_current_run_cleaning_progress') | float(1)
        | round(0)), \n                             hours = (states('sensor.valetudo_hestia_current_statistics_time')
        | float(0) / states('sensor.vacuum_current_run_cleaning_progress') | float(1)
        * (100 - states('sensor.vacuum_current_run_cleaning_progress') | float(1))
        // 60), \n                             minutes = (states('sensor.valetudo_hestia_current_statistics_time')
        | float(0) / states('sensor.vacuum_current_run_cleaning_progress') | float(1)
        * (100 - states('sensor.vacuum_current_run_cleaning_progress') | float(1))
        % 60)) %}\nThe vacuum is {{ 'in trouble' if not is_state('sensor.valetudo_hestia_error',
        'No error') else state_translated('vacuum.valetudo_hestia').lower() if states('vacuum.valetudo_hestia')
        != 'docked' else 'docked' }}. \nIts {{ 'current' if states('vacuum.valetudo_hestia')
        in ['cleaning', 'returning', 'paused'] or is_state('sensor.valetudo_hestia_dock_status',
        'cleaning') else 'last' }} run started {{ time_since(as_datetime(states('sensor.vacuum_last_run_started')))
        }} ago.\n{% if states('sensor.valetudo_hestia_current_statistics_area') |
        int(0) > 0 %}\n  It cleaned {{ states('sensor.valetudo_hestia_current_statistics_area')
        | int(0) }} square meters over {{ clean_time.hours | int(0) if clean_time.hours
        > 0 }} {{ 'hour' if clean_time.hours > 0 }}{{ 's' if clean_time.hours > 1
        }}{{ ' and ' if clean_time.hours > 0 and clean_time.minutes > 0 }}{{ clean_time.minutes
        | int(0) if clean_time.minutes > 0 }}{{ ' minute' if clean_time.minutes >
        0}}{{ 's' if clean_time.minutes > 1 }}.\n{% endif %}\n{% if states('sensor.vacuum_current_run_cleaning_progress')
        | int(0) > 0 %}\n  It will finish cleaning the remaining {{ 100 - states('sensor.vacuum_current_run_cleaning_progress')
        | int(0) }}% of the run in{{ remaining.hours | int(0) if remaining.hours >
        0 }} {{ 'hour' if remaining.hours > 0 }}{{ 's' if remaining.hours > 1 }}{{
        ' and ' if remaining.hours > 0 and remaining.minutes > 0 }}{{ remaining.minutes
        | int(0) if remaining.minutes > 0 }}{{ ' minute' if remaining.minutes > 0}}{{
        's' if remaining.minutes > 1 }} at {{ (now() + timedelta(hours = remaining.hours,
        minutes = remaining.minutes)).strftime('%I:%M%p') }}.\n{% endif %}\n{% if
        is_state('sensor.valetudo_hestia_dock_status', 'drying') %}\n  Its mops will
        finish drying at {{ as_local(as_datetime(states('sensor.vacuum_mop_drying_started'))
        + timedelta(hours = 3)).strftime('%I:%M%p') }}.\n{% endif %}\n"
  mode: single
- id: '1743851351763'
  alias: Voice Control for Stove
  description: Control the stove or request for stove status with voice commands
  triggers:
  - trigger: conversation
    command:
    - '{cooking_preset} on [the] {side} (cooker | stove | burner)'
    id: CookingPreset
  - trigger: conversation
    command:
    - Set [the] {side} (cooker | stove | burner) to [level] {power}
    id: SetCookerPower
  - trigger: conversation
    command:
    - Set [the] {side} (cooker | stove | burner) timer to {time} minute[s]
    id: SetCookerTimer
  - trigger: conversation
    command:
    - Turn off [the] {side} (cooker | stove | burner)
    id: TurnOffCooker
  - trigger: conversation
    command:
    - Is the {side} (cooker | stove | burner) (on | off)
    - (What is | What's) the (status | condition) of the {side} (cooker | stove |
      burner)
    id: CookerStatus
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - CookingPreset
      - condition: state
        entity_id: switch.stove_main_power
        state: 'on'
      sequence:
      - set_conversation_response: '{{ trigger.slots.side | capitalize }} cooker set
          to {{ trigger.slots.cooking_preset }}.'
      - variables:
          presets:
            Boil water:
              power: 7
              time: 6
            Cook rice:
              power: 1
              time: 16
            Stir fry:
              power: 4
              time: 0
            Simmer:
              power: 3
              time: 60
            Steam fish:
              power: 3
              time: 16
      - action: select.select_option
        metadata: {}
        data:
          option: '{{ trigger.slots.side }}'
        target:
          entity_id: select.stove_current_burner
      - action: script.stove_settings
        metadata: {}
        data:
          current_burner_power: '{{ presets[trigger.slots.cooking_preset].power }}'
          current_burner_timer: '{{ presets[trigger.slots.cooking_preset].time }}'
    - conditions:
      - condition: trigger
        id:
        - SetCookerPower
      - condition: state
        entity_id: switch.stove_main_power
        state: 'on'
      sequence:
      - set_conversation_response: '{{ trigger.slots.side | capitalize }} cooker set
          to level {{ trigger.slots.power }}.'
      - action: select.select_option
        metadata: {}
        data:
          option: '{{ trigger.slots.side }}'
        target:
          entity_id: select.stove_current_burner
      - if:
        - condition: template
          value_template: '{{ trigger.slots.power | length == 1 }}'
        then:
        - action: script.stove_settings
          metadata: {}
          data:
            current_burner_power: '{{ trigger.slots.power | int(0) }}'
        else:
        - action: script.stove_settings
          metadata: {}
          data:
            current_burner_power: '{{ trigger.slots.power.split('' '')[0] | int(0)
              }}'
            current_burner_timer: '{{ trigger.slots.power.split('' '')[2] | int(0)
              }}'
    - conditions:
      - condition: trigger
        id:
        - SetCookerTimer
      - condition: state
        entity_id: switch.stove_main_power
        state: 'on'
      sequence:
      - set_conversation_response: "{% if trigger.slots.time | int(0) == 0 %}\n  {{
          trigger.slots.side | capitalize }} cooker timer deactivated.\n{% else %}\n
          \ {{ trigger.slots.side | capitalize }} cooker timer set to {{ trigger.slots.time
          }} {{ 'minutes' if trigger.slots.time | int(0) > 1 else 'minute' }}.\n{%
          endif %}"
      - action: select.select_option
        metadata: {}
        data:
          option: '{{ trigger.slots.side }}'
        target:
          entity_id: select.stove_current_burner
      - action: script.stove_settings
        metadata: {}
        data:
          current_burner_timer: '{{ trigger.slots.time | int(0) }}'
    - conditions:
      - condition: trigger
        id:
        - TurnOffCooker
      - condition: state
        entity_id: switch.stove_main_power
        state: 'on'
      sequence:
      - set_conversation_response: '{{ trigger.slots.side | capitalize }} cooker deactivated.'
      - action: select.select_option
        metadata: {}
        data:
          option: '{{ trigger.slots.side }}'
        target:
          entity_id: select.stove_current_burner
      - action: script.stove_settings
        metadata: {}
        data:
          current_burner_power: 0
    - conditions:
      - condition: trigger
        id:
        - CookerStatus
      sequence:
      - if:
        - condition: state
          entity_id: switch.stove_main_power
          state: 'on'
        then:
        - action: select.select_option
          metadata: {}
          data:
            option: '{{ trigger.slots.side }}'
          target:
            entity_id: select.stove_current_burner
        - delay: 1
        - set_conversation_response: "{% set text = namespace(output = '') %}\n{%
            set text.output = 'The ' + states('select.stove_current_burner') + ' cooker
            is on level ' + states('select.stove_current_burner_power') %}\n{% if
            states('number.stove_current_burner_timer') | int(0) == 0 %}\n  {% set
            text.output = text.output + '.' %}\n{% elif states('number.stove_current_burner_timer')
            | int(0) == 1 %}\n  {% set text.output = text.output + ' with 1 minute
            remaining.' %}\n{% else %}\n  {% set text.output = text.output + ' with
            ' + states('number.stove_current_burner_timer') + ' minutes remaining.'
            %}\n{% endif %}\n{{ text.output }}\n"
        else:
        - set_conversation_response: The {{ trigger.slots.side }} cooker is off.
    default:
    - set_conversation_response: Unable to comply! Stove must be manually turned on
        first.
  mode: single
- id: '1744446876391'
  alias: Main Door Display
  description: Charge or turn on the Main Door Display
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.main_door_display_battery
    below: 10
    id: low
  - trigger: numeric_state
    entity_id:
    - sensor.main_door_display_battery
    below: 25
    id: low
  - trigger: numeric_state
    entity_id:
    - sensor.main_door_display_battery
    above: 80
    id: high
  - trigger: numeric_state
    entity_id:
    - sensor.main_door_display_battery
    above: 90
    id: high
  - trigger: state
    entity_id:
    - binary_sensor.dining_room_presence
    from: 'off'
    id: motion
    to: 'on'
  - alias: When the screen is on with no motion in the Dining Room for 5min
    trigger: template
    value_template: '{{ is_state(''switch.main_door_display_screen'', ''on'') and
      is_state(''binary_sensor.dining_room_presence'', ''off'') }}'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: no_motion
  - trigger: state
    entity_id:
    - binary_sensor.doorbell_motion
    from: 'off'
    to: 'on'
    id: visitor
  - trigger: template
    value_template: '{{ not ''/lovelace/0'' in states(''sensor.main_door_display_current_page'')
      and now() - states.sensor.main_door_display_current_page.last_updated > timedelta(minutes
      = 5) }}'
    id: reset_view
    alias: When the view has been left not on the homepage for 5min
  - trigger: state
    entity_id:
    - binary_sensor.main_door
    from: 'on'
    to: 'off'
    id: reset_view
  - trigger: state
    entity_id:
    - binary_sensor.main_door
    from: 'off'
    to: 'on'
    id: leaving
  - alias: When screen is on the homepage and the floorplan panel view has not changed
      for 1min
    trigger: template
    value_template: '{{ is_state(''switch.main_door_display_screen'', ''on'') and
      is_state(''sensor.main_door_display_current_page'', ''http://192.168.18.101:8123/lovelace/0'')
      and now() - states.input_select.floorplan_panel_view.last_updated > timedelta(minutes
      = 1) }}'
    id: change_view
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - low
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_door_display_charger
    - conditions:
      - condition: trigger
        id:
        - high
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_door_display_charger
    - conditions:
      - condition: trigger
        id:
        - motion
      sequence:
      - condition: state
        entity_id: input_boolean.away_mode
        state: 'off'
      - action: fully_kiosk.load_url
        metadata: {}
        data:
          device_id: a5d73504748daf7290dcf724d4c02a5a
          url: javascript:history.pushState(null,"","/lovelace/0");window.dispatchEvent(new
            CustomEvent("location-changed"));
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_door_display_screen
      - if:
        - condition: time
          after: input_datetime.dim_hours_start
          before: input_datetime.dim_hours_end
        then:
        - action: number.set_value
          metadata: {}
          data:
            value: '60'
          target:
            entity_id: number.main_door_display_screen_brightness
        else:
        - action: number.set_value
          metadata: {}
          data:
            value: '255'
          target:
            entity_id: number.main_door_display_screen_brightness
    - conditions:
      - condition: trigger
        id:
        - no_motion
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.main_door_display_screen
      - action: fully_kiosk.load_url
        metadata: {}
        data:
          device_id: a5d73504748daf7290dcf724d4c02a5a
          url: javascript:history.pushState(null,"","/lovelace/0");window.dispatchEvent(new
            CustomEvent("location-changed"));
    - conditions:
      - condition: trigger
        id:
        - visitor
      sequence:
      - condition: state
        entity_id:
        - binary_sensor.main_door
        - input_boolean.away_mode
        state: 'off'
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: sensor.main_door_display_current_page
            state:
            - http://192.168.18.101:8123/lovelace/0
        then:
        - action: fully_kiosk.load_url
          metadata: {}
          data:
            device_id: a5d73504748daf7290dcf724d4c02a5a
            url: javascript:history.pushState(null,"","/lovelace/0");window.dispatchEvent(new
              CustomEvent("location-changed"));
      - action: input_select.select_option
        metadata: {}
        data:
          option: main-door
        target:
          entity_id: input_select.floorplan_panel_view
    - conditions:
      - condition: trigger
        id:
        - reset_view
      sequence:
      - condition: template
        value_template: '{{ ''music_assistant'' not in states(''sensor.main_door_display_current_page'')
          }}'
      - action: fully_kiosk.load_url
        metadata: {}
        data:
          device_id: a5d73504748daf7290dcf724d4c02a5a
          url: javascript:history.pushState(null,"","/lovelace/0");window.dispatchEvent(new
            CustomEvent("location-changed"));
    - conditions:
      - condition: trigger
        id:
        - leaving
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: binary_sensor.doorbell_motion
          state: 'on'
          for:
            hours: 0
            minutes: 0
            seconds: 1
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: sensor.main_door_display_current_page
            state:
            - http://192.168.18.101:8123/lovelace/transit
        then:
        - action: fully_kiosk.load_url
          metadata: {}
          data:
            device_id: a5d73504748daf7290dcf724d4c02a5a
            url: javascript:history.pushState(null,"","/lovelace/transit");window.dispatchEvent(new
              CustomEvent("location-changed"));
    - conditions:
      - condition: trigger
        id:
        - change_view
      sequence:
      - if:
        - condition: state
          entity_id: input_select.floorplan_panel_view
          state:
          - transit
        then:
        - action: input_select.select_option
          metadata: {}
          data:
            option: weather
          target:
            entity_id: input_select.floorplan_panel_view
        else:
        - action: input_select.select_next
          metadata: {}
          data:
            cycle: true
          target:
            entity_id: input_select.floorplan_panel_view
  mode: restart
- id: '1751186099654'
  alias: Voice Control for Washer
  description: Get the washer status via voice assistants
  triggers:
  - trigger: conversation
    command:
    - What is the (washer | washing machine) doing
    - What is the status of the (washer | washing machine)
    - Is the (washer | washing machine) (running | spinning | rinsing | washing |
      off)
  conditions: []
  actions:
  - set_conversation_response: "The washer is {{ states('sensor.washer_status') |
      lower }}.\n{% if states('sensor.washer_status') == 'Off' %}\n  {% set wash_time
      = namespace(hours = states('sensor.washer_last_wash_duration').split(':')[0],\n
      \                              minutes = states('sensor.washer_last_wash_duration').split(':')[1])
      %}\n  Its last run took {{ wash_time.hours + ' hour' if wash_time.hours | int(0)
      > 0 }}{{ 's' if wash_time.hours | int(0) > 1 }}{{ ' and ' + wash_time.minutes
      + ' minute' }}{{ 's' if wash_time.minutes | int(0) > 1 }} and was completed
      {{ time_since(as_datetime(states('sensor.washer_last_wash_completed'))) }} ago.\n
      \ {{ 'Please unload the laundry.' if is_state('input_boolean.washer_load_clean',
      'on') }}\n{% else %}\n  {% set countdown = namespace(hours = ((states('sensor.washer_countdown')
      | float(0)) * 60 // 60) | int,\n                               minutes = ((states('sensor.washer_countdown')
      | float(0)) * 60 % 60) | int) %}\n  The current run started {{ time_since(as_datetime(states('sensor.washer_last_wash_started')))
      }} ago.\n  {% if countdown.hours > 0 or countdown.minutes > 0 %}\n  The remaining
      {{ 100 - states('sensor.washer_wash_progress') | int(0) }}% of the run will
      complete in {{ countdown.hours if countdown.hours > 0 }}{{ ' hours' if countdown.hours
      > 1 else ' hour' if countdown.hours == 1 }}{{ ' and ' if countdown.hours > 0
      and countdown.minutes > 0 }}{{ countdown.minutes if countdown.minutes > 0 }}{{
      ' minutes' if countdown.minutes > 1 else ' minute' if countdown.minutes == 1
      }} at {{ (now() + timedelta(hours = countdown.hours, minutes = countdown.minutes)).strftime('%I:%M%p')
      }}\n  {% endif %}\n{% endif %}"
  mode: single
- id: '1751186563137'
  alias: Voice Control for Dishwasher
  description: Get the dishwasher status via voice assistants
  triggers:
  - trigger: conversation
    command:
    - What is the dishwasher doing
    - What is the status of the dishwasher
    - Is the dishwasher (running | washing | cooling | off)
  conditions: []
  actions:
  - set_conversation_response: "The dishwasher is {{ states('input_select.dishwasher_status')
      | lower }}.\n{% if states('input_select.dishwasher_status') == 'Off' %}\n  {%
      set wash_time = namespace(hours = states('sensor.dishwasher_last_run_duration').split(':')[0],\n
      \                              minutes = states('sensor.dishwasher_last_run_duration').split(':')[1])
      %}\n  Its last run took {{ wash_time.hours + ' hour' if wash_time.hours | int(0)
      > 0 }}{{ 's' if wash_time.hours | int(0) > 1 }}{{ ' and ' + wash_time.minutes
      + ' minute' }}{{ 's' if wash_time.minutes | int(0) > 1 }} and was completed
      {{ time_since(as_datetime(states('sensor.dishwasher_last_run_ended'))) }} ago.\n
      \ {{ 'Please open the dishwasher door.' if is_state('input_boolean.dishwasher_load_clean',
      'on') }}\n{% else %}\n  The current run started {{ time_since(as_datetime(states('sensor.dishwasher_last_run_started')))
      }} ago.\n{% endif %}"
  mode: single
- id: '1751765390006'
  alias: Notify When Kitchen Blind State Desynced
  description: Send a notification when the Kitchen Blind's actual state may be desynced
    with assumed state
  triggers:
  - trigger: template
    value_template: "{{ (state_attr('cover.kitchen_blind','current_position') == 100
      and is_state('binary_sensor.kitchen_blind_opened', 'on')) or (state_attr('cover.kitchen_blind','current_position')
      == 0 and is_state('binary_sensor.kitchen_blind_closed', 'on')) or (state_attr('cover.kitchen_blind','current_position')
      != 100 and state_attr('cover.kitchen_blind','current_position') != 0 and (is_state('binary_sensor.kitchen_blind_opened',
      'off') or is_state('binary_sensor.kitchen_blind_closed', 'off')))\n }}"
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: template
    value_template: "{{ not ((state_attr('cover.kitchen_blind','current_position')
      == 100 and is_state('binary_sensor.kitchen_blind_opened', 'on')) or (state_attr('cover.kitchen_blind','current_position')
      == 0 and is_state('binary_sensor.kitchen_blind_closed', 'on')) or (state_attr('cover.kitchen_blind','current_position')
      != 100 and state_attr('cover.kitchen_blind','current_position') != 0 and (is_state('binary_sensor.kitchen_blind_opened',
      'off') or is_state('binary_sensor.kitchen_blind_closed', 'off'))))\n }}"
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: no_desync
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - no_desync
    then:
    - action: notify.mobile_app_aurora
      metadata: {}
      data:
        message: clear_notification
        data:
          tag: desynced
    else:
    - action: notify.mobile_app_aurora
      metadata: {}
      data:
        message: clear_notification
        data:
          tag: desynced
    - action: notify.mobile_app_aurora
      metadata: {}
      data:
        title: Kitchen Blind State Desynced
        message: Check Kitchen Blind.
        data:
          tag: desynced
  mode: single
- id: '1753576863029'
  alias: Parents' Room Motion Bedside Lamp
  description: Set Parents' Room Bedside Lamp when motion is detected, the door is
    open and no devices are on, depending on lux level and time.
  use_blueprint:
    path: danleongjy/motion_lights.yaml
    input:
      lights_list:
      - light.parents_room_bedside_lamp
      motion_sensor: binary_sensor.parents_room_presence
      lux_sensor: sensor.parents_room_lux
      entities_list:
      - light.parents_room_lights
      - fan.parents_room_fan
      - climate.parents_room_ac
      - light.parents_room_bedside_lamp
      doors_list:
      - binary_sensor.parents_room_door
      - binary_sensor.master_bathroom_door
      blackout_hours_start: input_datetime.sleep_hours_start
      blackout_hours_end: input_datetime.sleep_hours_end
- id: '1762069524284'
  alias: AC Set State with Target Temperature Changes
  description: Turn on or off an AC depending on how its target temperature changes
  triggers:
  - trigger: state
    entity_id:
    - climate.elenas_room_ac
    - climate.elis_room_ac
    - climate.dining_room_ac
    - climate.living_room_ac
    - climate.study_room_ac
    - climate.parents_room_ac
    attribute: temperature
    id: temp_change
  - trigger: state
    entity_id:
    - climate.elenas_room_ac
    - climate.elis_room_ac
    - climate.dining_room_ac
    - climate.living_room_ac
    - climate.study_room_ac
    - climate.parents_room_ac
    from: 'off'
    not_to:
    - unavailable
    - unknown
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - temp_change
    then:
    - if:
      - alias: If the new temp equals the AC's min temp
        condition: template
        value_template: '{{ state_attr(trigger.entity_id, "temperature") == state_attr(trigger.entity_id,
          ''min_temp'') }}'
      then:
      - alias: If AC's state is not off
        condition: template
        value_template: '{{ not is_state(trigger.entity_id, ''off'') }}'
      - action: climate.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: '{{ trigger.entity_id }}'
    else:
    - condition: template
      value_template: '{{ state_attr(trigger.entity_id, ''temperature'') == state_attr(trigger.entity_id,
        ''min_temp'') }}'
    - if:
      - condition: template
        value_template: '{{ trigger.entity_id in [''climate.elenas_room_ac'', ''climate.elis_room_ac'']
          }}'
        alias: If AC is Eli's or Elena's
      then:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: 28.5
        target:
          entity_id: '{{ trigger.entity_id }}'
      else:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: 27.5
        target:
          entity_id: '{{ trigger.entity_id }}'
  mode: single
- id: '1762751826856'
  alias: Vacuum Manual Control
  description: Manually control the vacuum using the Vacuum dashboard
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.vacuum_manual_control
    id: manual_control_toggle
  - trigger: state
    entity_id:
    - input_number.vacuum_manual_control_speed
    - input_number.vacuum_manual_control_turn
    id: vector
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - manual_control_toggle
    then:
    - action: rest_command.vacuum_manual_control
      metadata: {}
      data:
        manual_control: '{{ ''enable'' if is_state(trigger.entity_id, ''on'') else
          ''disable'' }}'
    - condition: state
      entity_id: input_boolean.vacuum_manual_control
      state: 'off'
    - action: vacuum.return_to_base
      metadata: {}
      data: {}
      target:
        entity_id: vacuum.valetudo_hestia
    else:
    - condition: state
      entity_id: input_boolean.vacuum_manual_control
      state: 'on'
    - variables:
        current_velocity: '{{ states(''input_number.vacuum_manual_control_speed'')
          | int(0) }}'
        current_angle: '{{ states(''input_number.vacuum_manual_control_turn'') | int(0)
          }}'
    - if:
      - condition: template
        value_template: '{{ is_state(''input_number.vacuum_manual_control_speed'',
          ''0'') or is_state(''input_number.vacuum_manual_control_turn'', ''0'') }}'
        alias: If speed or turn is 0
      then:
      - repeat:
          while:
          - condition: template
            value_template: "{{ states('input_number.vacuum_manual_control_speed')
              | int(0) == current_velocity and\n   states('input_number.vacuum_manual_control_turn')
              | int(0) == current_angle }}"
          sequence:
          - action: rest_command.vacuum_manual_control_vector
            metadata: {}
            data:
              velocity: '{{ current_velocity * 1 }}'
              angle: '{{ current_angle * 90 }}'
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 500
      else:
      - repeat:
          while:
          - condition: template
            value_template: "{{ states('input_number.vacuum_manual_control_speed')
              | int(0) == current_velocity and\n   states('input_number.vacuum_manual_control_turn')
              | int(0) == current_angle }}"
          sequence:
          - action: rest_command.vacuum_manual_control_vector
            metadata: {}
            data:
              velocity: '{{ current_velocity * 0.7 }}'
              angle: '{{ current_angle * 45 }}'
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 500
  mode: restart
- id: '1766280784751'
  alias: Vacuum Set Current Run Total Area
  description: Set the vacuum's current run total area when vacuum starts a new run
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.valetudo_hestia_current_statistics_area
    above: 0.1
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - action: homeassistant.update_entity
    metadata: {}
    data:
      entity_id:
      - sensor.vacuum_current_run_total_area
  mode: single
- id: '1766741089015'
  alias: Media Player Occupancy Following
  description: Transfer the playing queue to media players according to room occupancy
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.dining_room_presence
    - binary_sensor.living_room_presence
    - binary_sensor.study_room_radar_occupancy
    - binary_sensor.kitchen_radar_occupancy
    for:
      hours: 0
      minutes: 0
      seconds: 30
    id: motion
  - trigger: template
    value_template: '{{ ''on'' not in [states(''media_player.google_speakers''), states(''media_player.kitchen_speaker''),
      states(''media_player.study_room_speaker''), states(''media_player.dining_room_speaker''),
      ] }}'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    id: no_motion
  conditions:
  - alias: If a player is playing
    condition: template
    value_template: '{{ ''playing'' in [states(''media_player.dining_room_speaker''),
      states(''media_player.study_room_speaker''), states(''media_player.kitchen_speaker'')]
      }}'
  actions:
  - if:
    - condition: trigger
      id:
      - motion
    then:
    - choose:
      - conditions:
        - condition: state
          entity_id: binary_sensor.kitchen_radar_occupancy
          state:
          - 'on'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.living_room_presence
            state:
            - 'on'
          - condition: state
            entity_id: binary_sensor.dining_room_presence
            state:
            - 'on'
        - condition: state
          entity_id: binary_sensor.study_room_ethernet_connection
          state:
          - 'on'
        sequence:
        - condition: not
          conditions:
          - condition: state
            entity_id: media_player.dining_room_speaker
            state:
            - playing
          - condition: state
            entity_id: media_player.kitchen_speaker
            state:
            - playing
          alias: If Dining Room and Kitchen Speakers are not playing
        - parallel:
          - if:
            - condition: state
              entity_id: media_player.dining_room_speaker
              state:
              - 'off'
            then:
            - action: media_player.turn_on
              metadata: {}
              target:
                entity_id: media_player.dining_room_speaker
              data: {}
            - delay:
                hours: 0
                minutes: 0
                seconds: 5
                milliseconds: 0
          - if:
            - condition: state
              entity_id: media_player.kitchen_speaker
              state:
              - 'off'
            then:
            - action: media_player.turn_on
              metadata: {}
              data: {}
              target:
                entity_id: media_player.kitchen_speaker
            - delay:
                hours: 0
                minutes: 0
                seconds: 5
                milliseconds: 0
        - action: music_assistant.transfer_queue
          metadata: {}
          target:
            entity_id: media_player.google_speakers
          data:
            auto_play: true
        alias: If Kitchen, Living or Dining Rooms are occupied and Study Room Ethernet
          Connection is connected
      - conditions:
        - condition: state
          entity_id: binary_sensor.dining_room_presence
          state:
          - 'on'
        - condition: state
          entity_id: binary_sensor.kitchen_radar_occupancy
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.living_room_presence
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.study_room_radar_occupancy
          state:
          - 'off'
        sequence:
        - condition: not
          conditions:
          - condition: state
            entity_id: media_player.dining_room_speaker
            state:
            - playing
          alias: If Dining Room Speaker is not playing
        - if:
          - condition: state
            entity_id: media_player.dining_room_speaker
            state:
            - 'off'
          then:
          - action: media_player.turn_on
            metadata: {}
            target:
              entity_id: media_player.dining_room_speaker
            data: {}
          - delay:
              hours: 0
              minutes: 0
              seconds: 5
              milliseconds: 0
        - action: music_assistant.transfer_queue
          metadata: {}
          data:
            auto_play: true
          target:
            entity_id: media_player.dining_room_speaker
        alias: If only Dining Room is occupied
      - conditions:
        - condition: state
          entity_id: binary_sensor.kitchen_radar_occupancy
          state:
          - 'on'
        - condition: state
          entity_id: binary_sensor.dining_room_presence
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.living_room_presence
          state:
          - 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.study_room_radar_occupancy
            state:
            - 'off'
          - condition: state
            entity_id: binary_sensor.study_room_ethernet_connection
            state:
            - 'on'
        sequence:
        - alias: If Kitchen Speaker is not playing
          condition: not
          conditions:
          - condition: state
            entity_id: media_player.kitchen_speaker
            state:
            - playing
        - if:
          - condition: state
            entity_id: media_player.kitchen_speaker
            state:
            - 'off'
          then:
          - action: media_player.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: media_player.kitchen_speaker
          - delay:
              hours: 0
              minutes: 0
              seconds: 5
              milliseconds: 0
        - action: music_assistant.transfer_queue
          metadata: {}
          target:
            entity_id: media_player.kitchen_speaker
          data:
            auto_play: true
        alias: If Kitchen is occupied, Dining Room and Kitchen are clear and Study
          Room Ethernet Connection is connected or Study Room is clear
      - conditions:
        - condition: state
          entity_id: binary_sensor.kitchen_radar_occupancy
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.dining_room_presence
          state:
          - 'off'
        - condition: or
          conditions:
          - condition: state
            entity_id: binary_sensor.living_room_presence
            state:
            - 'on'
          - condition: state
            entity_id: binary_sensor.study_room_radar_occupancy
            state:
            - 'on'
        - condition: state
          entity_id: binary_sensor.study_room_ethernet_connection
          state:
          - 'off'
        sequence:
        - alias: If Study Room Speaker is not playing
          condition: not
          conditions:
          - condition: state
            entity_id: media_player.study_room_speaker
            state:
            - playing
        - if:
          - condition: state
            entity_id: media_player.study_room_speaker
            state:
            - 'off'
          then:
          - action: media_player.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: media_player.study_room_speaker
          - delay:
              hours: 0
              minutes: 0
              seconds: 5
              milliseconds: 0
        - action: music_assistant.transfer_queue
          metadata: {}
          target:
            entity_id: media_player.study_room_speaker
          data:
            auto_play: true
      - conditions:
        - condition: state
          entity_id: binary_sensor.dining_room_presence
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.living_room_presence
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.kitchen_radar_occupancy
          state:
          - 'off'
        - condition: state
          entity_id: binary_sensor.study_room_radar_occupancy
          state:
          - 'off'
        sequence:
        - repeat:
            for_each:
            - media_player.google_speakers
            - media_player.study_room_speaker
            - media_player.kitchen_speaker
            - media_player.dining_room_speaker
            sequence:
            - if:
              - condition: template
                value_template: '{{ is_state(repeat.item, ''playing'') }}'
              then:
              - action: media_player.media_pause
                metadata: {}
                target:
                  entity_id: '{{ repeat.item }}'
                data: {}
    else:
    - repeat:
        for_each:
        - media_player.google_speakers
        - media_player.dining_room_speaker
        - media_player.kitchen_speaker
        - media_player.study_room_speaker
        sequence:
        - action: media_player.clear_playlist
          metadata: {}
          target:
            entity_id: '{{ repeat.item }}'
          data: {}
        - condition: template
          value_template: '{{ not is_state(repeat.item, ''off'') }}'
        - action: media_player.turn_off
          metadata: {}
          target:
            entity_id: '{{ repeat.item }}'
          data: {}
  mode: single
- id: '1766971457601'
  alias: Elena's Room Motion Automations
  description: Turn on Elena's Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - elenas_room
      motion_sensor: binary_sensor.elenas_room_presence
      entities_list:
      - light.elenas_room_lights
      - light.elenas_room_bedside_lamp
      - fan.elenas_room_fan
      - climate.elenas_room_ac
      doors_list:
      - binary_sensor.elenas_room_door
- id: '1766971695927'
  alias: Eli's Room Motion Automations
  description: Turn on Eli's Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - elis_room
      motion_sensor: binary_sensor.elis_room_presence
      entities_list:
      - light.elis_room_lights
      - light.elis_room_floor_lamp
      - fan.elis_room_fan
      - climate.elis_room_ac
      doors_list:
      - binary_sensor.elis_room_door
- id: '1766971927955'
  alias: Parents' Room Motion Automations
  description: Turn on Parents' Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - parents_room
      motion_sensor: binary_sensor.parents_room_presence
      entities_list:
      - light.parents_room_lights
      - light.parents_room_bedside_lamp
      - fan.parents_room_fan
      - climate.parents_room_ac
      doors_list:
      - binary_sensor.parents_room_doors
- id: '1766972031229'
  alias: Junior Bathroom Motion Automations
  description: Turn on Junior Bathroom motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - junior_bathroom
      motion_sensor: binary_sensor.junior_bathroom_occupancy
      entities_list:
      - light.junior_bathroom_lights
      doors_list:
      - binary_sensor.junior_bathroom_door
- id: '1766972116803'
  alias: Powder Room Motion Automations
  description: Turn on Powder Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - powder_room
      motion_sensor: binary_sensor.powder_room_occupancy
      entities_list:
      - light.powder_room_pendant_light_entity
      doors_list:
      - binary_sensor.powder_room_door
- id: '1766972235442'
  alias: Master Bathroom Motion Automations
  description: Turn on Master Bathroom motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - master_bathroom
      motion_sensor: binary_sensor.master_bathroom_occupancy
      entities_list:
      - light.master_bathroom_lights
      doors_list:
      - binary_sensor.master_bathroom_door
- id: '1766972419103'
  alias: Yard Motion Automations
  description: Turn on Yard motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - yard
      motion_sensor: binary_sensor.yard_motion
      entities_list:
      - light.yard_light_entity
      time_period: 40
- id: '1766972552039'
  alias: Playroom Motion Automations
  description: Turn on Playroom motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - playroom
      motion_sensor: binary_sensor.playroom_presence
      entities_list:
      - light.playroom_lights
- id: '1766972609964'
  alias: Kitchen Motion Automations
  description: Turn on Kitchen motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - kitchen
      motion_sensor: binary_sensor.kitchen_radar_occupancy
      entities_list:
      - light.kitchen_lights
      time_period: 40
- id: '1766972717203'
  alias: Hallway Motion Automations
  description: Turn on Hallway motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - hallway
      motion_sensor: binary_sensor.hallway_motion
      entities_list:
      - light.hallway_lights
- id: '1766972796408'
  alias: Dining Room Motion Automations
  description: Turn on Dining Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - dining_room
      motion_sensor: binary_sensor.dining_room_presence
      entities_list:
      - light.dining_room_lights
      - light.dining_room_pendant_light_entity
      - fan.dining_room_fan
      - climate.dining_room_ac
      doors_list: []
- id: '1766972884064'
  alias: Living Room Motion Automations
  description: Turn on Living Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - living_room
      motion_sensor: binary_sensor.living_room_presence
      entities_list:
      - light.living_room_lights
      - light.living_room_pendant_light_entity
      - fan.living_room_fan
      - climate.living_room_ac
- id: '1766972981571'
  alias: Study Room Motion Automations
  description: Turn on Study Room motion automations when motion is detected
  use_blueprint:
    path: danleongjy/motion_automations.yaml
    input:
      room:
      - study_room
      motion_sensor: binary_sensor.study_room_radar_occupancy
      entities_list:
      - light.study_room_lights
      - light.study_room_floor_lamp
      - fan.study_room_fan
      - climate.study_room_ac
      doors_list:
      - binary_sensor.parents_room_door
